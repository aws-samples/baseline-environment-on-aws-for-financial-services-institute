// Jest Snapshot v1, https://goo.gl/fbAQLP

exports[`Core Banking System Stack should create core banking system stack 1`] = `
{
  "Description": "Core banking system infrastructure (sample implementation)",
  "Metadata": {
    "cdk_nag": {
      "rules_to_suppress": [
        {
          "id": "AwsSolutions-SQS4",
          "reason": "Lambda dead letter queue is configured with SSL enforcement through explicit SQS queue configuration with enforceSSL: true.",
        },
        {
          "id": "AwsSolutions-L1",
          "is_reason_encoded": true,
          "reason": "44Kr44K544K/44Og44Oq44K944O844K555SoTGFtYmRh6Zai5pWw44GvQ0RL44Gr44KI44Gj44Gm6Ieq5YuV566h55CG44GV44KM44Gm44GK44KK44CBcnVudGltZSB2ZXJzaW9u44GvQ0RL44Gu44OQ44O844K444On44Oz44Ki44OD44OX5pmC44Gr5pu05paw44GV44KM44G+44GZ44CC",
        },
        {
          "applies_to": [
            "Resource::*",
          ],
          "id": "AwsSolutions-IAM5",
          "is_reason_encoded": true,
          "reason": "Q0RL44GM6Ieq5YuV55Sf5oiQ44GZ44KLRGVmYXVsdFBvbGljeeOBq+OBr+OAgUxhbWJkYemWouaVsOOBruWfuuacrOeahOOBquWun+ihjOOBq+W/heimgeOBquaoqemZkOOBjOWQq+OBvuOCjOOBpuOBhOOBvuOBmeOAguOBk+OCjOOCieOBruaoqemZkOOBr0NES+OBruWGhemDqOWLleS9nOOBq+OCiOOCi+OCguOBruOBp+OBguOCiuOAgeOCu+OCreODpeODquODhuOCo+S4iuW/heimgeOBquacgOWwj+aoqemZkOOBp+OBmeOAgg==",
        },
        {
          "id": "AwsSolutions-COG4",
          "is_reason_encoded": true,
          "reason": "Q29yZSBCYW5raW5nIEFQSeOBr+WQjOS4gOOCt+OCueODhuODoOWGheOBrk1vYmlsZSBCYW5raW5nIEJhY2tlbmTjgYvjgonjga7lhoXpg6jpgKPmkLrlsILnlKhBUEnjgafjgZnjgIJDb2duaXRvIFVzZXIgUG9vbOiqjeiovOOBp+OBr+OBquOBj+OAgUlBTeiqjeiovOOCkuS9v+eUqOOBl+OBpuOCt+OCueODhuODoOmWk+OBruiqjeiovOOCkuihjOOBo+OBpuOBhOOBvuOBmeOAguOBk+OCjOOBq+OCiOOCiuOAgeWklumDqOOBi+OCieOBruebtOaOpeOCouOCr+OCu+OCueOCkumYsuOBjuOAgemBqeWIh+OBquOCouOCr+OCu+OCueWItuW+oeOCkuWun+ePvuOBl+OBpuOBhOOBvuOBmeOAgg==",
        },
        {
          "id": "AwsSolutions-APIG4",
          "is_reason_encoded": true,
          "reason": "Q29yZSBCYW5raW5nIEFQSeOBr+WQjOS4gOOCt+OCueODhuODoOWGheOBrk1vYmlsZSBCYW5raW5nIEJhY2tlbmTjgYvjgonjga7lhoXpg6jpgKPmkLrlsILnlKhBUEnjgafjgZnjgIJJQU3oqo3oqLzjgahBUEkgS2V56KqN6Ki844KS57WE44G/5ZCI44KP44Gb44KL44GT44Go44Gn44CB6YGp5YiH44Gq6KqN6Ki844O76KqN5Y+v44KS5a6f6KOF44GX44Gm44GE44G+44GZ44CCQ09SU+OBrk9QVElPTlPjg6Hjgr3jg4Pjg4njgavjgaTjgYTjgabjgoLjgIHlkIzkuIDjgrfjgrnjg4bjg6DlhoXjgafjga7liKnnlKjjgavpmZDlrprjgZXjgozjgabjgYTjgovjgZ/jgoHjgIHjgrvjgq3jg6Xjg6rjg4bjgqPkuIrjga7llY/poYzjga/jgYLjgorjgb7jgZvjgpPjgII=",
        },
      ],
    },
  },
  "Outputs": {
    "AccountsTableName": {
      "Description": "Core Banking Accounts Table Name",
      "Value": {
        "Ref": "CoreAccountsTable91531FEB",
      },
    },
    "CoreApiEndpoint": {
      "Description": "Temporary Core Banking System API endpoint",
      "Export": {
        "Name": "CoreBankingSystemStack-CoreApiEndpoint",
      },
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Ref": "CoreBankingApi9CC99DBE",
            },
            ".execute-api.ap-northeast-1.",
            {
              "Ref": "AWS::URLSuffix",
            },
            "/",
            {
              "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
            },
            "/",
          ],
        ],
      },
    },
    "CoreApiId": {
      "Description": "Core Banking API Gateway ID",
      "Value": {
        "Ref": "CoreBankingApi9CC99DBE",
      },
    },
    "CoreApiKeyId": {
      "Description": "Core Banking API Key ID",
      "Export": {
        "Name": "CoreBankingSystemStack-CoreApiKeyId",
      },
      "Value": {
        "Ref": "CoreBankingApiCoreBankingApiKey30F6B290",
      },
    },
    "CoreApiLambdaArn": {
      "Description": "Core Banking API Lambda Function ARN",
      "Value": {
        "Fn::GetAtt": [
          "CoreApiLambdaAF859631",
          "Arn",
        ],
      },
    },
    "CoreApiStage": {
      "Description": "Core Banking API Gateway Stage",
      "Value": {
        "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
      },
    },
    "CoreApiUsagePlan": {
      "Description": "Core Banking API Usage Plan ID",
      "Value": {
        "Ref": "CoreBankingApiCoreBankingUsagePlanD660B0C6",
      },
    },
    "CoreBankingApiEndpointEAE9E41D": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Ref": "CoreBankingApi9CC99DBE",
            },
            ".execute-api.ap-northeast-1.",
            {
              "Ref": "AWS::URLSuffix",
            },
            "/",
            {
              "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
            },
            "/",
          ],
        ],
      },
    },
    "CustomersTableName": {
      "Description": "Core Banking Customers Table Name",
      "Value": {
        "Ref": "CoreCustomersTable2B7842D6",
      },
    },
    "TransactionsTableName": {
      "Description": "Core Banking Transactions Table Name",
      "Value": {
        "Ref": "CoreTransactionsTableCA8AB329",
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AWS679f53fac002430cb0da5b7982bd22872D164C4C": {
      "DependsOn": [
        "CustomResourceRoleAB1EF463",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "4cd2f2411231aa073e609dc99a49b5c5e974252bf9abf0f9350d237d17cce8be.zip",
        },
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "CustomResourceRoleAB1EF463",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Timeout": 120,
      },
      "Type": "AWS::Lambda::Function",
    },
    "CoreAccountsTable91531FEB": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "accountId",
            "AttributeType": "S",
          },
          {
            "AttributeName": "customerId",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "CustomerIdIndex",
            "KeySchema": [
              {
                "AttributeName": "customerId",
                "KeyType": "HASH",
              },
            ],
            "Projection": {
              "ProjectionType": "ALL",
            },
          },
        ],
        "KeySchema": [
          {
            "AttributeName": "accountId",
            "KeyType": "HASH",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "CoreBankingKmsKeyB64C7E9C",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
        "StreamSpecification": {
          "StreamViewType": "NEW_AND_OLD_IMAGES",
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Delete",
    },
    "CoreApiAccessLogGroupBCEDC348": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/aws/apigateway/core-banking-api",
        "RetentionInDays": 7,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "CoreApiCloudWatchRoleDDB26F3E": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Policy::arn:<AWS::Partition>:iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs",
              ],
              "id": "AwsSolutions-IAM4",
              "is_reason_encoded": true,
              "reason": "QVBJIEdhdGV3YXnjga5DbG91ZFdhdGNoIExvZ3PjgqLjgq/jgrvjgrnjgavjga/jgIFBV1PjgYzmj5DkvpvjgZnjgovmqJnmupbnmoTjgarnrqHnkIbjg53jg6rjgrfjg7zjgIxBbWF6b25BUElHYXRld2F5UHVzaFRvQ2xvdWRXYXRjaExvZ3PjgI3jgpLkvb/nlKjjgZfjgabjgYTjgb7jgZnjgILjgZPjgozjga9BV1PjgYzmjqjlpajjgZnjgovmlrnms5XjgafjgYLjgorjgIHjgrvjgq3jg6Xjg6rjg4bjgqPkuIrpganliIfjgafjgZnjgII=",
            },
            {
              "applies_to": [
                "Resource::*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "QVBJIEdhdGV3YXnjga5DbG91ZFdhdGNoIExvZ3PjgqLjgq/jgrvjgrnjgavjga/jgIHli5XnmoTjgavkvZzmiJDjgZXjgozjgovjg63jgrDjgrnjg4jjg6rjg7zjg6Djgbjjga7jgqLjgq/jgrvjgrnmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjga9BV1MgQVBJIEdhdGV3YXnjga7mqJnmupbnmoTjgarli5XkvZzjgafjgYLjgorjgIHjgrvjgq3jg6Xjg6rjg4bjgqPkuIrlv4XopoHjgarmnIDlsI/mqKnpmZDjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "apigateway.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CoreApiDeadLetterQueueEC51B8F1": {
      "DeletionPolicy": "Delete",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SQS4",
              "reason": "SQS queue enforces SSL with enforceSSL: true setting. This is a false positive from CDK Nag.",
            },
          ],
        },
      },
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "CoreBankingKmsKeyB64C7E9C",
            "Arn",
          ],
        },
        "QueueName": "core-banking-api-dlq-ap-northeast-1",
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "CoreApiDeadLetterQueuePolicy391A89DD": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "CoreApiDeadLetterQueueEC51B8F1",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "CoreApiDeadLetterQueueEC51B8F1",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "CoreApiExecutionRoleDefaultPolicy49A27AF3": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "execute-api:Invoke",
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":execute-api:ap-northeast-1:111111111111:",
                      {
                        "Ref": "CoreBankingApi9CC99DBE",
                      },
                      "/v1/GET/api/customers/{customerId}",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":execute-api:ap-northeast-1:111111111111:",
                      {
                        "Ref": "CoreBankingApi9CC99DBE",
                      },
                      "/v1/POST/api/customers",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":execute-api:ap-northeast-1:111111111111:",
                      {
                        "Ref": "CoreBankingApi9CC99DBE",
                      },
                      "/v1/GET/api/accounts/{accountId}",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":execute-api:ap-northeast-1:111111111111:",
                      {
                        "Ref": "CoreBankingApi9CC99DBE",
                      },
                      "/v1/GET/api/accounts/{accountId}/transactions",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":execute-api:ap-northeast-1:111111111111:",
                      {
                        "Ref": "CoreBankingApi9CC99DBE",
                      },
                      "/v1/POST/api/accounts",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":execute-api:ap-northeast-1:111111111111:",
                      {
                        "Ref": "CoreBankingApi9CC99DBE",
                      },
                      "/v1/GET/api/transaction/{transactionId}",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":execute-api:ap-northeast-1:111111111111:",
                      {
                        "Ref": "CoreBankingApi9CC99DBE",
                      },
                      "/v1/POST/api/transactions/deposit",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":execute-api:ap-northeast-1:111111111111:",
                      {
                        "Ref": "CoreBankingApi9CC99DBE",
                      },
                      "/v1/POST/api/transactions/withdraw",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Ref": "CoreBankingApiCoreBankingApiKey30F6B290",
                    },
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CoreApiExecutionRoleDefaultPolicy49A27AF3",
        "Roles": [
          {
            "Ref": "CoreApiExecutionRoleFC7EEAC8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CoreApiExecutionRoleFC7EEAC8": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-*",
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-*:*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44GT44KM44GvQVdT44Gu5qiZ5rqW55qE44Gq5YuV5L2c44Gn44GZ44CC",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Description": "Execution role for Online Banking App to access Core Banking API",
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-*",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-*:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CoreApiGatewayAccount": {
      "DependsOn": [
        "CoreApiCloudWatchRoleDDB26F3E",
      ],
      "Properties": {
        "CloudWatchRoleArn": {
          "Fn::GetAtt": [
            "CoreApiCloudWatchRoleDDB26F3E",
            "Arn",
          ],
        },
      },
      "Type": "AWS::ApiGateway::Account",
    },
    "CoreApiLambdaAF859631": {
      "DependsOn": [
        "CoreApiRoleDefaultPolicy532B5FA2",
        "CoreApiRoleFD696CAE",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::*",
              ],
              "id": "AwsSolutions-SQS4",
              "reason": "Dead letter queue is configured with SSL enforcement through explicit SQS queue configuration.",
            },
          ],
        },
      },
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "65d34c7d2303d6b1d8f03c40af4662ed0782814465c417f7eaa0389bf97a9da0.zip",
        },
        "DeadLetterConfig": {
          "TargetArn": {
            "Fn::GetAtt": [
              "CoreApiDeadLetterQueueEC51B8F1",
              "Arn",
            ],
          },
        },
        "Environment": {
          "Variables": {
            "ACCOUNTS_TABLE": {
              "Ref": "CoreAccountsTable91531FEB",
            },
            "CUSTOMERS_TABLE": {
              "Ref": "CoreCustomersTable2B7842D6",
            },
            "NODE_ENV": "production",
            "TRANSACTIONS_TABLE": {
              "Ref": "CoreTransactionsTableCA8AB329",
            },
          },
        },
        "FunctionName": "core-banking-api",
        "Handler": "index.handler",
        "LoggingConfig": {
          "LogGroup": {
            "Ref": "CoreApiLogGroup66A4A415",
          },
        },
        "MemorySize": 512,
        "ReservedConcurrentExecutions": 100,
        "Role": {
          "Fn::GetAtt": [
            "CoreApiRoleFD696CAE",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 30,
        "TracingConfig": {
          "Mode": "Active",
        },
      },
      "Type": "AWS::Lambda::Function",
    },
    "CoreApiLogGroup66A4A415": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/aws/lambda/core-banking-api",
        "RetentionInDays": 7,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "CoreApiRoleDefaultPolicy532B5FA2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:SendMessage",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "CoreApiDeadLetterQueueEC51B8F1",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "xray:PutTraceSegments",
                "xray:PutTelemetryRecords",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CoreApiRoleDefaultPolicy532B5FA2",
        "Roles": [
          {
            "Ref": "CoreApiRoleFD696CAE",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "CoreApiRoleFD696CAE": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "dynamodb:GetItem",
                    "dynamodb:PutItem",
                    "dynamodb:UpdateItem",
                    "dynamodb:DeleteItem",
                    "dynamodb:Query",
                    "dynamodb:Scan",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    {
                      "Fn::GetAtt": [
                        "CoreCustomersTable2B7842D6",
                        "Arn",
                      ],
                    },
                    {
                      "Fn::GetAtt": [
                        "CoreAccountsTable91531FEB",
                        "Arn",
                      ],
                    },
                    {
                      "Fn::GetAtt": [
                        "CoreTransactionsTableCA8AB329",
                        "Arn",
                      ],
                    },
                    {
                      "Fn::Join": [
                        "",
                        [
                          {
                            "Fn::GetAtt": [
                              "CoreAccountsTable91531FEB",
                              "Arn",
                            ],
                          },
                          "/index/CustomerIdIndex",
                        ],
                      ],
                    },
                    {
                      "Fn::Join": [
                        "",
                        [
                          {
                            "Fn::GetAtt": [
                              "CoreTransactionsTableCA8AB329",
                              "Arn",
                            ],
                          },
                          "/index/AccountIdIndex",
                        ],
                      ],
                    },
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "DynamoDBAccess",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    {
                      "Fn::GetAtt": [
                        "CoreApiLogGroup66A4A415",
                        "Arn",
                      ],
                    },
                    {
                      "Fn::Join": [
                        "",
                        [
                          {
                            "Fn::GetAtt": [
                              "CoreApiLogGroup66A4A415",
                              "Arn",
                            ],
                          },
                          ":*",
                        ],
                      ],
                    },
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "CoreBankingKmsKeyB64C7E9C",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CoreBankingApi9CC99DBE": {
      "Properties": {
        "Description": "Core Banking System API with IAM Authentication for Mobile Banking Backend",
        "EndpointConfiguration": {
          "Types": [
            "REGIONAL",
          ],
        },
        "Name": "Core Banking System API (Internal)",
        "Policy": {
          "Statement": [
            {
              "Action": "execute-api:Invoke",
              "Condition": {
                "StringEquals": {
                  "aws:RequestedRegion": "ap-northeast-1",
                },
                "StringLike": {
                  "aws:userid": [
                    "AROA*:online-banking-*",
                    "AROA*:*",
                  ],
                },
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::111111111111:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::ApiGateway::RestApi",
    },
    "CoreBankingApiCoreApiRequestValidator71DA0B07": {
      "Properties": {
        "Name": "core-api-request-validator",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
        "ValidateRequestBody": true,
        "ValidateRequestParameters": true,
      },
      "Type": "AWS::ApiGateway::RequestValidator",
    },
    "CoreBankingApiCoreBankingApiKey30F6B290": {
      "Properties": {
        "Description": "Core Banking System API Key for usage control",
        "Enabled": true,
        "Name": "core-banking-system-api-key",
        "StageKeys": [
          {
            "RestApiId": {
              "Ref": "CoreBankingApi9CC99DBE",
            },
            "StageName": {
              "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
            },
          },
        ],
      },
      "Type": "AWS::ApiGateway::ApiKey",
    },
    "CoreBankingApiCoreBankingUsagePlanD660B0C6": {
      "Properties": {
        "ApiStages": [
          {
            "ApiId": {
              "Ref": "CoreBankingApi9CC99DBE",
            },
            "Stage": {
              "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
            },
            "Throttle": {},
          },
        ],
        "Description": "Core Banking System Usage Plan for transaction control",
        "Quota": {
          "Limit": 100000,
          "Period": "DAY",
        },
        "Throttle": {
          "BurstLimit": 1000,
          "RateLimit": 500,
        },
        "UsagePlanName": "core-banking-system-usage-plan",
      },
      "Type": "AWS::ApiGateway::UsagePlan",
    },
    "CoreBankingApiCoreBankingUsagePlanUsagePlanKeyResourceCoreBankingSystemStackCoreBankingApiCoreBankingApiKey9A819F14FC079B88": {
      "Properties": {
        "KeyId": {
          "Ref": "CoreBankingApiCoreBankingApiKey30F6B290",
        },
        "KeyType": "API_KEY",
        "UsagePlanId": {
          "Ref": "CoreBankingApiCoreBankingUsagePlanD660B0C6",
        },
      },
      "Type": "AWS::ApiGateway::UsagePlanKey",
    },
    "CoreBankingApiDeploymentC4F5B4D1748444119dde059598c6afe760480189": {
      "DependsOn": [
        "CoreBankingApiCoreApiRequestValidator71DA0B07",
        "CoreBankingApiapiaccountsaccountIdGET01B8D88F",
        "CoreBankingApiapiaccountsaccountIdOPTIONSB503F999",
        "CoreBankingApiapiaccountsaccountIdBEE33FC0",
        "CoreBankingApiapiaccountsaccountIdtransactionsGETC7B91D80",
        "CoreBankingApiapiaccountsaccountIdtransactionsOPTIONS07DD09F6",
        "CoreBankingApiapiaccountsaccountIdtransactionsF9199755",
        "CoreBankingApiapiaccountsOPTIONS071AD2FC",
        "CoreBankingApiapiaccountsPOSTD24AC064",
        "CoreBankingApiapiaccounts4BF18FA7",
        "CoreBankingApiapicustomerscustomerIdGET128A0CE4",
        "CoreBankingApiapicustomerscustomerIdOPTIONS27648D7F",
        "CoreBankingApiapicustomerscustomerIdA5EA552C",
        "CoreBankingApiapicustomersOPTIONS0E3814F1",
        "CoreBankingApiapicustomersPOSTB7764760",
        "CoreBankingApiapicustomers71B6F251",
        "CoreBankingApiapiOPTIONS27BB23AB",
        "CoreBankingApiapi9A0BD438",
        "CoreBankingApiapitransactiontransactionIdGETD05857FC",
        "CoreBankingApiapitransactiontransactionIdOPTIONS9E6109B6",
        "CoreBankingApiapitransactiontransactionIdE1F5E6A8",
        "CoreBankingApiapitransactionOPTIONS7FDEAF93",
        "CoreBankingApiapitransactionF0E0E406",
        "CoreBankingApiapitransactionsdepositOPTIONSF53CBA34",
        "CoreBankingApiapitransactionsdepositPOST76F93F36",
        "CoreBankingApiapitransactionsdepositB0478046",
        "CoreBankingApiapitransactionsOPTIONSBECA4806",
        "CoreBankingApiapitransactions6C2EEE2E",
        "CoreBankingApiapitransactionswithdrawOPTIONS815823FF",
        "CoreBankingApiapitransactionswithdrawPOST723E08B0",
        "CoreBankingApiapitransactionswithdraw40858676",
        "CoreBankingApiOPTIONS12D90704",
      ],
      "Properties": {
        "Description": "Core Banking System API with IAM Authentication for Mobile Banking Backend",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Deployment",
    },
    "CoreBankingApiDeploymentStagev1373CABF3": {
      "Properties": {
        "AccessLogSetting": {
          "DestinationArn": {
            "Fn::GetAtt": [
              "CoreApiAccessLogGroupBCEDC348",
              "Arn",
            ],
          },
          "Format": "{"requestId":"$context.requestId","ip":"$context.identity.sourceIp","user":"$context.identity.user","caller":"$context.identity.caller","requestTime":"$context.requestTime","httpMethod":"$context.httpMethod","resourcePath":"$context.resourcePath","status":"$context.status","protocol":"$context.protocol","responseLength":"$context.responseLength"}",
        },
        "DeploymentId": {
          "Ref": "CoreBankingApiDeploymentC4F5B4D1748444119dde059598c6afe760480189",
        },
        "MethodSettings": [
          {
            "DataTraceEnabled": true,
            "HttpMethod": "*",
            "LoggingLevel": "INFO",
            "MetricsEnabled": true,
            "ResourcePath": "/*",
          },
        ],
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
        "StageName": "v1",
        "TracingEnabled": true,
      },
      "Type": "AWS::ApiGateway::Stage",
    },
    "CoreBankingApiOPTIONS12D90704": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Fn::GetAtt": [
            "CoreBankingApi9CC99DBE",
            "RootResourceId",
          ],
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapi9A0BD438": {
      "Properties": {
        "ParentId": {
          "Fn::GetAtt": [
            "CoreBankingApi9CC99DBE",
            "RootResourceId",
          ],
        },
        "PathPart": "api",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "CoreBankingApiapiOPTIONS27BB23AB": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapi9A0BD438",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapiaccounts4BF18FA7": {
      "Properties": {
        "ParentId": {
          "Ref": "CoreBankingApiapi9A0BD438",
        },
        "PathPart": "accounts",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "CoreBankingApiapiaccountsOPTIONS071AD2FC": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapiaccounts4BF18FA7",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapiaccountsPOSTApiPermissionCoreBankingSystemStackCoreBankingApi6647B6F0POSTapiaccountsDAE53690": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/",
              {
                "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
              },
              "/POST/api/accounts",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapiaccountsPOSTApiPermissionTestCoreBankingSystemStackCoreBankingApi6647B6F0POSTapiaccounts58B9A5FD": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/test-invoke-stage/POST/api/accounts",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapiaccountsPOSTD24AC064": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "AWS_IAM",
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "200",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "400",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "500",
            },
          ],
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "CoreApiLambdaAF859631",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Origin": true,
            },
            "StatusCode": "201",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapiaccounts4BF18FA7",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapiaccountsaccountIdBEE33FC0": {
      "Properties": {
        "ParentId": {
          "Ref": "CoreBankingApiapiaccounts4BF18FA7",
        },
        "PathPart": "{accountId}",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "CoreBankingApiapiaccountsaccountIdGET01B8D88F": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "AWS_IAM",
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "200",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "400",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "500",
            },
          ],
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "CoreApiLambdaAF859631",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Origin": true,
            },
            "StatusCode": "200",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapiaccountsaccountIdBEE33FC0",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapiaccountsaccountIdGETApiPermissionCoreBankingSystemStackCoreBankingApi6647B6F0GETapiaccountsaccountId4BEA0801": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/",
              {
                "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
              },
              "/GET/api/accounts/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapiaccountsaccountIdGETApiPermissionTestCoreBankingSystemStackCoreBankingApi6647B6F0GETapiaccountsaccountId5F67529C": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/test-invoke-stage/GET/api/accounts/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapiaccountsaccountIdOPTIONSB503F999": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapiaccountsaccountIdBEE33FC0",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapiaccountsaccountIdtransactionsF9199755": {
      "Properties": {
        "ParentId": {
          "Ref": "CoreBankingApiapiaccountsaccountIdBEE33FC0",
        },
        "PathPart": "transactions",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "CoreBankingApiapiaccountsaccountIdtransactionsGETApiPermissionCoreBankingSystemStackCoreBankingApi6647B6F0GETapiaccountsaccountIdtransactionsC2453C6E": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/",
              {
                "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
              },
              "/GET/api/accounts/*/transactions",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapiaccountsaccountIdtransactionsGETApiPermissionTestCoreBankingSystemStackCoreBankingApi6647B6F0GETapiaccountsaccountIdtransactions589B7E09": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/test-invoke-stage/GET/api/accounts/*/transactions",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapiaccountsaccountIdtransactionsGETC7B91D80": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "AWS_IAM",
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "200",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "400",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "500",
            },
          ],
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "CoreApiLambdaAF859631",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Origin": true,
            },
            "StatusCode": "200",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapiaccountsaccountIdtransactionsF9199755",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapiaccountsaccountIdtransactionsOPTIONS07DD09F6": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapiaccountsaccountIdtransactionsF9199755",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapicustomers71B6F251": {
      "Properties": {
        "ParentId": {
          "Ref": "CoreBankingApiapi9A0BD438",
        },
        "PathPart": "customers",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "CoreBankingApiapicustomersOPTIONS0E3814F1": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapicustomers71B6F251",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapicustomersPOSTApiPermissionCoreBankingSystemStackCoreBankingApi6647B6F0POSTapicustomers3632DD4C": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/",
              {
                "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
              },
              "/POST/api/customers",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapicustomersPOSTApiPermissionTestCoreBankingSystemStackCoreBankingApi6647B6F0POSTapicustomers9785199A": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/test-invoke-stage/POST/api/customers",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapicustomersPOSTB7764760": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "AWS_IAM",
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "200",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "400",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "500",
            },
          ],
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "CoreApiLambdaAF859631",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Origin": true,
            },
            "StatusCode": "201",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapicustomers71B6F251",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapicustomerscustomerIdA5EA552C": {
      "Properties": {
        "ParentId": {
          "Ref": "CoreBankingApiapicustomers71B6F251",
        },
        "PathPart": "{customerId}",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "CoreBankingApiapicustomerscustomerIdGET128A0CE4": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "AWS_IAM",
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "200",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "400",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "500",
            },
          ],
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "CoreApiLambdaAF859631",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Origin": true,
            },
            "StatusCode": "200",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapicustomerscustomerIdA5EA552C",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapicustomerscustomerIdGETApiPermissionCoreBankingSystemStackCoreBankingApi6647B6F0GETapicustomerscustomerId51D46394": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/",
              {
                "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
              },
              "/GET/api/customers/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapicustomerscustomerIdGETApiPermissionTestCoreBankingSystemStackCoreBankingApi6647B6F0GETapicustomerscustomerIdAE3635EB": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/test-invoke-stage/GET/api/customers/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapicustomerscustomerIdOPTIONS27648D7F": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapicustomerscustomerIdA5EA552C",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapitransactionF0E0E406": {
      "Properties": {
        "ParentId": {
          "Ref": "CoreBankingApiapi9A0BD438",
        },
        "PathPart": "transaction",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "CoreBankingApiapitransactionOPTIONS7FDEAF93": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapitransactionF0E0E406",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapitransactions6C2EEE2E": {
      "Properties": {
        "ParentId": {
          "Ref": "CoreBankingApiapi9A0BD438",
        },
        "PathPart": "transactions",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "CoreBankingApiapitransactionsOPTIONSBECA4806": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapitransactions6C2EEE2E",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapitransactionsdepositB0478046": {
      "Properties": {
        "ParentId": {
          "Ref": "CoreBankingApiapitransactions6C2EEE2E",
        },
        "PathPart": "deposit",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "CoreBankingApiapitransactionsdepositOPTIONSF53CBA34": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapitransactionsdepositB0478046",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapitransactionsdepositPOST76F93F36": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "AWS_IAM",
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "200",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "400",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "500",
            },
          ],
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "CoreApiLambdaAF859631",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Origin": true,
            },
            "StatusCode": "200",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapitransactionsdepositB0478046",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapitransactionsdepositPOSTApiPermissionCoreBankingSystemStackCoreBankingApi6647B6F0POSTapitransactionsdeposit35486678": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/",
              {
                "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
              },
              "/POST/api/transactions/deposit",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapitransactionsdepositPOSTApiPermissionTestCoreBankingSystemStackCoreBankingApi6647B6F0POSTapitransactionsdepositD298209D": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/test-invoke-stage/POST/api/transactions/deposit",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapitransactionswithdraw40858676": {
      "Properties": {
        "ParentId": {
          "Ref": "CoreBankingApiapitransactions6C2EEE2E",
        },
        "PathPart": "withdraw",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "CoreBankingApiapitransactionswithdrawOPTIONS815823FF": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapitransactionswithdraw40858676",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapitransactionswithdrawPOST723E08B0": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "AWS_IAM",
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "200",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "400",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "500",
            },
          ],
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "CoreApiLambdaAF859631",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Origin": true,
            },
            "StatusCode": "200",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapitransactionswithdraw40858676",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapitransactionswithdrawPOSTApiPermissionCoreBankingSystemStackCoreBankingApi6647B6F0POSTapitransactionswithdraw74FD301E": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/",
              {
                "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
              },
              "/POST/api/transactions/withdraw",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapitransactionswithdrawPOSTApiPermissionTestCoreBankingSystemStackCoreBankingApi6647B6F0POSTapitransactionswithdrawD1C18BC7": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/test-invoke-stage/POST/api/transactions/withdraw",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapitransactiontransactionIdE1F5E6A8": {
      "Properties": {
        "ParentId": {
          "Ref": "CoreBankingApiapitransactionF0E0E406",
        },
        "PathPart": "{transactionId}",
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "CoreBankingApiapitransactiontransactionIdGETApiPermissionCoreBankingSystemStackCoreBankingApi6647B6F0GETapitransactiontransactionId9C2B8B25": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/",
              {
                "Ref": "CoreBankingApiDeploymentStagev1373CABF3",
              },
              "/GET/api/transaction/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapitransactiontransactionIdGETApiPermissionTestCoreBankingSystemStackCoreBankingApi6647B6F0GETapitransactiontransactionId075BA0A1": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "CoreApiLambdaAF859631",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "CoreBankingApi9CC99DBE",
              },
              "/test-invoke-stage/GET/api/transaction/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "CoreBankingApiapitransactiontransactionIdGETD05857FC": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "AWS_IAM",
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "200",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "400",
            },
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Origin": "'*'",
              },
              "StatusCode": "500",
            },
          ],
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "CoreApiLambdaAF859631",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Origin": true,
            },
            "StatusCode": "200",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapitransactiontransactionIdE1F5E6A8",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingApiapitransactiontransactionIdOPTIONS9E6109B6": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "CoreBankingApiapitransactiontransactionIdE1F5E6A8",
        },
        "RestApiId": {
          "Ref": "CoreBankingApi9CC99DBE",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "CoreBankingKmsKeyAliasC3C795BA": {
      "Properties": {
        "AliasName": "alias/core-banking-system",
        "TargetKeyId": {
          "Fn::GetAtt": [
            "CoreBankingKmsKeyB64C7E9C",
            "Arn",
          ],
        },
      },
      "Type": "AWS::KMS::Alias",
    },
    "CoreBankingKmsKeyB64C7E9C": {
      "DeletionPolicy": "Delete",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-KMS5",
              "is_reason_encoded": true,
              "reason": "S01T44Kt44O844Od44Oq44K344O844Gn44Gv44CB44Kt44O8566h55CG44Go44OH44O844K/44Ki44Kv44K744K544Gu6IG35o6M5YiG6Zui44KS5a6f54++44GZ44KL44Gf44KB44CB6YGp5YiH44Gq44OX44Oq44Oz44K344OR44Or44Gr5a++44GX44Gm44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44KS5LuY5LiO44GX44Gm44GE44G+44GZ44CC44GT44KM44GvRklTQ+WuieWFqOWvvuetluWfuua6luOBruaal+WPt+WMlumNteeuoeeQhuimgeS7tuOBq+a6luaLoOOBl+OBn+ioreioiOOBp+OBmeOAgg==",
            },
          ],
        },
      },
      "Properties": {
        "Description": "Core Banking System encryption key for FISC compliance",
        "EnableKeyRotation": true,
        "KeyPolicy": {
          "Statement": [
            {
              "Action": "kms:*",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::111111111111:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
              "Sid": "EnableRootAccountAccess",
            },
            {
              "Action": [
                "kms:Create*",
                "kms:Describe*",
                "kms:Enable*",
                "kms:List*",
                "kms:Put*",
                "kms:Update*",
                "kms:Revoke*",
                "kms:Disable*",
                "kms:Get*",
                "kms:Delete*",
                "kms:TagResource",
                "kms:UntagResource",
                "kms:ScheduleKeyDeletion",
                "kms:CancelKeyDeletion",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": "cloudformation.amazonaws.com",
              },
              "Resource": "*",
              "Sid": "AllowKeyAdministration",
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "dynamodb.amazonaws.com",
                  "s3.amazonaws.com",
                  "lambda.amazonaws.com",
                  "sqs.amazonaws.com",
                  "logs.amazonaws.com",
                ],
              },
              "Resource": "*",
              "Sid": "AllowKeyUsage",
            },
            {
              "Action": [
                "kms:CreateGrant",
                "kms:ListGrants",
                "kms:RevokeGrant",
              ],
              "Condition": {
                "Bool": {
                  "kms:GrantIsForAWSResource": "true",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "dynamodb.amazonaws.com",
                  "s3.amazonaws.com",
                  "lambda.amazonaws.com",
                  "sqs.amazonaws.com",
                  "logs.amazonaws.com",
                ],
              },
              "Resource": "*",
              "Sid": "AllowAttachmentOfPersistentResources",
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
                "kms:DescribeKey",
              ],
              "Condition": {
                "StringEquals": {
                  "kms:ViaService": [
                    "dynamodb.ap-northeast-1.amazonaws.com",
                  ],
                },
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::111111111111:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
              "Sid": "AllowCustomResourceAccess",
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
                "kms:DescribeKey",
              ],
              "Condition": {
                "StringEquals": {
                  "aws:SourceAccount": "111111111111",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
              "Resource": "*",
              "Sid": "AllowLambdaDirectAccess",
            },
          ],
          "Version": "2012-10-17",
        },
        "PendingWindowInDays": 30,
        "Tags": [
          {
            "Key": "Environment",
            "Value": "CoreBankingSystemStack",
          },
          {
            "Key": "KeyRotation",
            "Value": "Enabled",
          },
          {
            "Key": "Purpose",
            "Value": "FISC-Compliance",
          },
        ],
      },
      "Type": "AWS::KMS::Key",
      "UpdateReplacePolicy": "Delete",
    },
    "CoreCustomersTable2B7842D6": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "customerId",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "KeySchema": [
          {
            "AttributeName": "customerId",
            "KeyType": "HASH",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "CoreBankingKmsKeyB64C7E9C",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
        "StreamSpecification": {
          "StreamViewType": "NEW_AND_OLD_IMAGES",
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Delete",
    },
    "CoreTransactionsTableCA8AB329": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "transactionId",
            "AttributeType": "S",
          },
          {
            "AttributeName": "timestamp",
            "AttributeType": "S",
          },
          {
            "AttributeName": "accountId",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "AccountIdIndex",
            "KeySchema": [
              {
                "AttributeName": "accountId",
                "KeyType": "HASH",
              },
              {
                "AttributeName": "timestamp",
                "KeyType": "RANGE",
              },
            ],
            "Projection": {
              "ProjectionType": "ALL",
            },
          },
        ],
        "KeySchema": [
          {
            "AttributeName": "transactionId",
            "KeyType": "HASH",
          },
          {
            "AttributeName": "timestamp",
            "KeyType": "RANGE",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "CoreBankingKmsKeyB64C7E9C",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
        "StreamSpecification": {
          "StreamViewType": "NEW_AND_OLD_IMAGES",
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Delete",
    },
    "CustomApiGatewayAccount": {
      "Properties": {
        "CloudWatchRoleArn": {
          "Fn::GetAtt": [
            "CoreApiCloudWatchRoleDDB26F3E",
            "Arn",
          ],
        },
      },
      "Type": "AWS::ApiGateway::Account",
    },
    "CustomResourceRoleAB1EF463": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/core-banking-custom-resource-*",
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/core-banking-custom-resource-*:*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "44Kr44K544K/44Og44Oq44K944O844K555SoTGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44GT44KM44GvQVdT44Gu5qiZ5rqW55qE44Gq5YuV5L2c44Gn44GZ44CC",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/core-banking-custom-resource-*",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/core-banking-custom-resource-*:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": "dynamodb:PutItem",
                  "Effect": "Allow",
                  "Resource": [
                    {
                      "Fn::GetAtt": [
                        "CoreCustomersTable2B7842D6",
                        "Arn",
                      ],
                    },
                    {
                      "Fn::GetAtt": [
                        "CoreAccountsTable91531FEB",
                        "Arn",
                      ],
                    },
                    {
                      "Fn::GetAtt": [
                        "CoreTransactionsTableCA8AB329",
                        "Arn",
                      ],
                    },
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "DynamoDBPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Decrypt",
                    "kms:GenerateDataKey",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "CoreBankingKmsKeyB64C7E9C",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "DefaultAccount1Data31C47D74": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "CoreAccountsTable91531FEB",
        "DefaultCustomer1Data72945DC3",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"DynamoDB","action":"putItem","parameters":{"TableName":"",
              {
                "Ref": "CoreAccountsTable91531FEB",
              },
              "","Item":{"accountId":{"S":"0011234567"},"customerId":{"S":"CUST001"},"branchCode":{"S":"001"},"branchName":{"S":"オンラインバンキング支店"},"accountType":{"S":"SAVINGS"},"balance":{"N":"10000000"},"currency":{"S":"JPY"},"status":{"S":"ACTIVE"},"createdAt":{"S":"2025-09-18T00:50:15.000Z"},"updatedAt":{"S":"2025-09-18T00:50:15.000Z"}}},"physicalResourceId":{"id":"default-account1-data"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "DefaultAccount2Data0075FD02": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "CoreAccountsTable91531FEB",
        "DefaultCustomer2Data8AEC81C4",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"DynamoDB","action":"putItem","parameters":{"TableName":"",
              {
                "Ref": "CoreAccountsTable91531FEB",
              },
              "","Item":{"accountId":{"S":"0017654321"},"customerId":{"S":"CUST002"},"branchCode":{"S":"001"},"branchName":{"S":"オンラインバンキング支店"},"accountType":{"S":"SAVINGS"},"balance":{"N":"10000000"},"currency":{"S":"JPY"},"status":{"S":"ACTIVE"},"createdAt":{"S":"2025-09-18T00:50:15.000Z"},"updatedAt":{"S":"2025-09-18T00:50:15.000Z"}}},"physicalResourceId":{"id":"default-account2-data"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "DefaultCustomer1Data72945DC3": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "CoreCustomersTable2B7842D6",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"DynamoDB","action":"putItem","parameters":{"TableName":"",
              {
                "Ref": "CoreCustomersTable2B7842D6",
              },
              "","Item":{"customerId":{"S":"CUST001"},"lastName":{"S":"キンユウ"},"firstName":{"S":"リファレンスアーキテクチャ"},"email":{"S":"user001@example.com"},"phone":{"S":"090-0000-0001"},"status":{"S":"ACTIVE"},"createdAt":{"S":"2025-09-18T00:50:15.000Z"},"updatedAt":{"S":"2025-09-18T00:50:15.000Z"}}},"physicalResourceId":{"id":"default-customer1-data"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "DefaultCustomer2Data8AEC81C4": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "CoreCustomersTable2B7842D6",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"DynamoDB","action":"putItem","parameters":{"TableName":"",
              {
                "Ref": "CoreCustomersTable2B7842D6",
              },
              "","Item":{"customerId":{"S":"CUST002"},"lastName":{"S":"モダン"},"firstName":{"S":"アプリケーション"},"email":{"S":"user002@example.com"},"phone":{"S":"090-0000-0002"},"status":{"S":"ACTIVE"},"createdAt":{"S":"2025-09-18T00:50:15.000Z"},"updatedAt":{"S":"2025-09-18T00:50:15.000Z"}}},"physicalResourceId":{"id":"default-customer2-data"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "DefaultTransaction1A0980B85": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "CoreTransactionsTableCA8AB329",
        "DefaultAccount1Data31C47D74",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"DynamoDB","action":"putItem","parameters":{"TableName":"",
              {
                "Ref": "CoreTransactionsTableCA8AB329",
              },
              "","Item":{"transactionId":{"S":"TXN001"},"timestamp":{"S":"2024-01-15T10:00:00Z"},"accountId":{"S":"0011234567"},"type":{"S":"TRANSFER_DEPOSIT"},"amount":{"N":"20000000"},"currency":{"S":"JPY"},"status":{"S":"COMPLETED"},"description":{"S":"振込による入金"},"sourceAccountId":{"S":"9999999"},"transferId":{"S":"TRF001"},"transferType":{"S":"INBOUND"},"processedAt":{"S":"2024-01-15T10:00:00Z"}}},"physicalResourceId":{"id":"default-transaction1"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "DefaultTransaction26BD53CBE": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "CoreTransactionsTableCA8AB329",
        "DefaultAccount1Data31C47D74",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"DynamoDB","action":"putItem","parameters":{"TableName":"",
              {
                "Ref": "CoreTransactionsTableCA8AB329",
              },
              "","Item":{"transactionId":{"S":"TXN002"},"timestamp":{"S":"2024-02-10T14:30:00Z"},"accountId":{"S":"0011234567"},"type":{"S":"TRANSFER_WITHDRAWAL"},"amount":{"N":"-5000000"},"currency":{"S":"JPY"},"status":{"S":"COMPLETED"},"description":{"S":"振込による出金"},"targetAccountId":{"S":"0017654321"},"transferId":{"S":"TRF002"},"transferType":{"S":"OUTBOUND"},"processedAt":{"S":"2024-02-10T14:30:00Z"}}},"physicalResourceId":{"id":"default-transaction2"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "DefaultTransaction35BAB9999": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "CoreTransactionsTableCA8AB329",
        "DefaultAccount1Data31C47D74",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"DynamoDB","action":"putItem","parameters":{"TableName":"",
              {
                "Ref": "CoreTransactionsTableCA8AB329",
              },
              "","Item":{"transactionId":{"S":"TXN003"},"timestamp":{"S":"2024-03-05T16:45:00Z"},"accountId":{"S":"0011234567"},"type":{"S":"ATM_WITHDRAWAL"},"amount":{"N":"-5000000"},"currency":{"S":"JPY"},"status":{"S":"COMPLETED"},"description":{"S":"ATM出金"},"processedAt":{"S":"2024-03-05T16:45:00Z"}}},"physicalResourceId":{"id":"default-transaction3"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "DefaultTransaction4D8E4F6C9": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "CoreTransactionsTableCA8AB329",
        "DefaultAccount2Data0075FD02",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"DynamoDB","action":"putItem","parameters":{"TableName":"",
              {
                "Ref": "CoreTransactionsTableCA8AB329",
              },
              "","Item":{"transactionId":{"S":"TXN004"},"timestamp":{"S":"2024-01-20T11:15:00Z"},"accountId":{"S":"0017654321"},"type":{"S":"ATM_DEPOSIT"},"amount":{"N":"5000000"},"currency":{"S":"JPY"},"status":{"S":"COMPLETED"},"description":{"S":"ATM入金"},"processedAt":{"S":"2024-01-20T11:15:00Z"}}},"physicalResourceId":{"id":"default-transaction4"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "DefaultTransaction55543460D": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "CoreTransactionsTableCA8AB329",
        "DefaultAccount2Data0075FD02",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"DynamoDB","action":"putItem","parameters":{"TableName":"",
              {
                "Ref": "CoreTransactionsTableCA8AB329",
              },
              "","Item":{"transactionId":{"S":"TXN005"},"timestamp":{"S":"2024-02-10T14:30:00Z"},"accountId":{"S":"0017654321"},"type":{"S":"TRANSFER_DEPOSIT"},"amount":{"N":"5000000"},"currency":{"S":"JPY"},"status":{"S":"COMPLETED"},"description":{"S":"振込による入金"},"sourceAccountId":{"S":"0011234567"},"transferId":{"S":"TRF002"},"transferType":{"S":"INBOUND"},"processedAt":{"S":"2024-02-10T14:30:00Z"}}},"physicalResourceId":{"id":"default-transaction5"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Online Banking App Backend Stack should create backend stack 1`] = `
{
  "Description": "Online banking application backend infrastructure",
  "Metadata": {
    "cdk_nag": {
      "rules_to_suppress": [
        {
          "id": "AwsSolutions-L1",
          "is_reason_encoded": true,
          "reason": "44Kr44K544K/44Og44Oq44K944O844K555SoTGFtYmRh6Zai5pWw44GvQ0RL44Gr44KI44Gj44Gm6Ieq5YuV566h55CG44GV44KM44Gm44GK44KK44CBcnVudGltZSB2ZXJzaW9u44GvQ0RL44Gu44OQ44O844K444On44Oz44Ki44OD44OX5pmC44Gr5pu05paw44GV44KM44G+44GZ44CC",
        },
        {
          "applies_to": [
            "Resource::*",
            "Resource::arn:aws:execute-api:ap-northeast-1:111111111111:*/v1/*/*",
            "Action::kms:ReEncrypt*",
            "Action::kms:GenerateDataKey*",
          ],
          "id": "AwsSolutions-IAM5",
          "is_reason_encoded": true,
          "reason": "Q0RL44GM6Ieq5YuV55Sf5oiQ44GZ44KLRGVmYXVsdFBvbGljeeOBq+OBr+OAgUxhbWJkYemWouaVsOOBruWfuuacrOeahOOBquWun+ihjOOBq+W/heimgeOBquaoqemZkOOBjOWQq+OBvuOCjOOBpuOBhOOBvuOBmeOAguOBk+OCjOOCieOBruaoqemZkOOBr0NES+OBruWGhemDqOWLleS9nOOBq+OCiOOCi+OCguOBruOBp+OBguOCiuOAgeOCu+OCreODpeODquODhuOCo+S4iuW/heimgeOBquacgOWwj+aoqemZkOOBp+OBmeOAguOBvuOBn+OAgUNvcmUgQmFua2luZyBBUEnjgbjjga7jgqLjgq/jgrvjgrnmqKnpmZDjgafplovnmbrnkrDlooPjgafjga/lhbfkvZPnmoTjgapBUEkgSUTjgYzkuI3mmI7jgarjgZ/jgoHjgIHjg5Xjgqnjg7zjg6vjg5Djg4Pjgq/mqKnpmZDjgajjgZfjgabjg6/jgqTjg6vjg4njgqvjg7zjg4njgpLkvb/nlKjjgZfjgabjgYTjgb7jgZnjgIJLTVPmqKnpmZDjgavjgaTjgYTjgabjgoLjgIFEeW5hbW9EQuOCteODvOODk+OCuee1jOeUseOBp+OBruOBv+OCouOCr+OCu+OCueWPr+iDveOBq+WItumZkOOBleOCjOOBpuOBiuOCiuOAgeOCu+OCreODpeODquODhuOCo+S4iumBqeWIh+OBp+OBmeOAgg==",
        },
      ],
    },
  },
  "Outputs": {
    "BankingApiEndpoint": {
      "Description": "Banking API endpoint for frontend configuration",
      "Export": {
        "Name": "OnlineBankingBankingApiEndpoint",
      },
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Ref": "BankingApi8E314CEB",
            },
            ".execute-api.ap-northeast-1.",
            {
              "Ref": "AWS::URLSuffix",
            },
            "/",
            {
              "Ref": "BankingApiDeploymentStagev1B20C046B",
            },
            "/",
          ],
        ],
      },
    },
    "BankingApiEndpointEBDF5703": {
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Ref": "BankingApi8E314CEB",
            },
            ".execute-api.ap-northeast-1.",
            {
              "Ref": "AWS::URLSuffix",
            },
            "/",
            {
              "Ref": "BankingApiDeploymentStagev1B20C046B",
            },
            "/",
          ],
        ],
      },
    },
    "BankingApiWebACLArn": {
      "Description": "Banking API WAF Web ACL ARN",
      "Value": {
        "Fn::GetAtt": [
          "BankingApiWebACL",
          "Arn",
        ],
      },
    },
    "CoreApiBaseUrl": {
      "Description": "Core Banking API Base URL being used",
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
            },
            ".execute-api.ap-northeast-1.",
            {
              "Ref": "AWS::URLSuffix",
            },
            "/",
            {
              "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiDeploymentStagev1373CABF394B313B5",
            },
            "/",
          ],
        ],
      },
    },
    "MailDeliveryApiEndpoint": {
      "Description": "Mail Delivery API endpoint being used",
      "Value": "https://your-mail-delivery-api.com/api/v1",
    },
    "SessionsTableName": {
      "Description": "Sessions Table Name",
      "Value": {
        "Ref": "SessionsTable7C302024",
      },
    },
    "UsersTableName": {
      "Description": "Users Table Name",
      "Value": {
        "Ref": "UsersTable9725E9C8",
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AWS679f53fac002430cb0da5b7982bd22872D164C4C": {
      "DependsOn": [
        "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "4cd2f2411231aa073e609dc99a49b5c5e974252bf9abf0f9350d237d17cce8be.zip",
        },
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
            "Arn",
          ],
        },
        "Runtime": "nodejs20.x",
        "Timeout": 120,
      },
      "Type": "AWS::Lambda::Function",
    },
    "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2": {
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "AccountOpeningCompletedEventRule07779EDA": {
      "Properties": {
        "EventBusName": {
          "Ref": "BankingEventBus7929F6BE",
        },
        "EventPattern": {
          "detail-type": [
            "AccountOpeningApplicationCompleted",
          ],
          "source": [
            "banking.account-opening",
          ],
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "AccountOpeningNotificationLambdaC7AEF068",
                "Arn",
              ],
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "AccountOpeningCompletedEventRuleAllowEventRuleOnlineBankingAppBackendStackAccountOpeningNotificationLambdaCF73C4D64C61DB98": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AccountOpeningNotificationLambdaC7AEF068",
            "Arn",
          ],
        },
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::GetAtt": [
            "AccountOpeningCompletedEventRule07779EDA",
            "Arn",
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "AccountOpeningCreatedEventRule52A99858": {
      "Properties": {
        "EventBusName": {
          "Ref": "BankingEventBus7929F6BE",
        },
        "EventPattern": {
          "detail-type": [
            "AccountOpeningApplicationCreated",
          ],
          "source": [
            "banking.account-opening",
          ],
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "AccountOpeningNotificationLambdaC7AEF068",
                "Arn",
              ],
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "AccountOpeningCreatedEventRuleAllowEventRuleOnlineBankingAppBackendStackAccountOpeningNotificationLambdaCF73C4D6DE41B28C": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AccountOpeningNotificationLambdaC7AEF068",
            "Arn",
          ],
        },
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::GetAtt": [
            "AccountOpeningCreatedEventRule52A99858",
            "Arn",
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "AccountOpeningEventStoreD41E30A3": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "aggregateId",
            "AttributeType": "S",
          },
          {
            "AttributeName": "version",
            "AttributeType": "N",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "KeySchema": [
          {
            "AttributeName": "aggregateId",
            "KeyType": "HASH",
          },
          {
            "AttributeName": "version",
            "KeyType": "RANGE",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "OnlineBankingKmsKey20BDBC63",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
        "StreamSpecification": {
          "StreamViewType": "NEW_AND_OLD_IMAGES",
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Delete",
    },
    "AccountOpeningLambdaB96501D4": {
      "DependsOn": [
        "AccountOpeningLambdaRoleDefaultPolicy8ABF82F5",
        "AccountOpeningLambdaRoleAE92995F",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "3e01979a00391872feda68f8b715c50fbb309a3b476c7ffc7fb81afdd03db8f7.zip",
        },
        "Environment": {
          "Variables": {
            "ACCOUNT_OPENING_EVENT_STORE_TABLE": {
              "Ref": "AccountOpeningEventStoreD41E30A3",
            },
            "ACCOUNT_OPENING_OUTBOX_TABLE": {
              "Ref": "AccountOpeningOutboxTable3ABEE0AF",
            },
            "CORE_API_BASE_URL": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                  },
                  ".execute-api.ap-northeast-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiDeploymentStagev1373CABF394B313B5",
                  },
                  "/",
                ],
              ],
            },
            "CORE_API_KEY_ID": {
              "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
            },
            "EVENT_BUS_NAME": {
              "Ref": "BankingEventBus7929F6BE",
            },
            "NODE_ENV": "production",
          },
        },
        "FunctionName": "online-banking-account-opening",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "AccountOpeningLambdaRoleAE92995F",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 30,
      },
      "Type": "AWS::Lambda::Function",
    },
    "AccountOpeningLambdaRoleAE92995F": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-account-opening:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-account-opening",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-account-opening:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "AccountOpeningLambdaRoleDefaultPolicy8ABF82F5": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:Query",
                "dynamodb:Scan",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "AccountOpeningEventStoreD41E30A3",
                    "Arn",
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "AccountOpeningOutboxTable3ABEE0AF",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "AccountOpeningOutboxTable3ABEE0AF",
                          "Arn",
                        ],
                      },
                      "/index/StatusIndex",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "events:PutEvents",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "BankingEventBus7929F6BE",
                  "Arn",
                ],
              },
            },
            {
              "Action": "execute-api:Invoke",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:execute-api:ap-northeast-1:111111111111:",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
                    },
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "AccountOpeningLambdaRoleDefaultPolicy8ABF82F5",
        "Roles": [
          {
            "Ref": "AccountOpeningLambdaRoleAE92995F",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "AccountOpeningNotificationLambdaC7AEF068": {
      "DependsOn": [
        "AccountOpeningNotificationLambdaRoleDefaultPolicy08B83595",
        "AccountOpeningNotificationLambdaRole670D509B",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "aea3c7a083c378080a0b1f9f2d3f964c307fb71d3545561babd1ca756fccf35f.zip",
        },
        "Environment": {
          "Variables": {
            "ACCOUNT_OPENING_EVENT_STORE_TABLE": {
              "Ref": "AccountOpeningEventStoreD41E30A3",
            },
            "MAIL_DELIVERY_API": "https://your-mail-delivery-api.com/api/v1",
            "MAIL_DELIVERY_API_KEY": "",
            "NODE_ENV": "production",
            "SENDER_EMAIL": "noreply@example.com",
          },
        },
        "FunctionName": "online-banking-account-opening-notification",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "AccountOpeningNotificationLambdaRole670D509B",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 60,
      },
      "Type": "AWS::Lambda::Function",
    },
    "AccountOpeningNotificationLambdaRole670D509B": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-account-opening-notification:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-account-opening-notification",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-account-opening-notification:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "AccountOpeningNotificationLambdaRoleDefaultPolicy08B83595": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:Query",
                "dynamodb:Scan",
                "dynamodb:UpdateItem",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "AccountOpeningEventStoreD41E30A3",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "AccountOpeningNotificationLambdaRoleDefaultPolicy08B83595",
        "Roles": [
          {
            "Ref": "AccountOpeningNotificationLambdaRole670D509B",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "AccountOpeningOutboxProcessorLambda29D6E859": {
      "DependsOn": [
        "AccountOpeningOutboxProcessorLambdaRoleDefaultPolicyC8FF6E5F",
        "AccountOpeningOutboxProcessorLambdaRoleD4592AB4",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "6a7127c46377fd4dec0f1f390142b61f893d284d01c78dc7a9e571afba68763a.zip",
        },
        "Environment": {
          "Variables": {
            "ACCOUNT_OPENING_EVENT_STORE_TABLE": {
              "Ref": "AccountOpeningEventStoreD41E30A3",
            },
            "ACCOUNT_OPENING_OUTBOX_TABLE": {
              "Ref": "AccountOpeningOutboxTable3ABEE0AF",
            },
            "BANKING_API_ENDPOINT": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Ref": "BankingApi8E314CEB",
                  },
                  ".execute-api.ap-northeast-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/",
                  {
                    "Ref": "BankingApiDeploymentStagev1B20C046B",
                  },
                  "/",
                ],
              ],
            },
            "CORE_API_BASE_URL": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                  },
                  ".execute-api.ap-northeast-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiDeploymentStagev1373CABF394B313B5",
                  },
                  "/",
                ],
              ],
            },
            "CORE_API_KEY_ID": {
              "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
            },
            "CUSTOMER_API_KEY_ID": {
              "Ref": "CustomerApiKey38731FBE",
            },
            "EVENT_BUS_NAME": {
              "Ref": "BankingEventBus7929F6BE",
            },
            "NODE_ENV": "production",
          },
        },
        "FunctionName": "online-banking-account-opening-outbox-processor",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "AccountOpeningOutboxProcessorLambdaRoleD4592AB4",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 300,
      },
      "Type": "AWS::Lambda::Function",
    },
    "AccountOpeningOutboxProcessorLambdaDynamoDBEventSourceOnlineBankingAppBackendStackAccountOpeningOutboxTable44E2A473081D870B": {
      "Properties": {
        "BatchSize": 5,
        "EventSourceArn": {
          "Fn::GetAtt": [
            "AccountOpeningOutboxTable3ABEE0AF",
            "StreamArn",
          ],
        },
        "FilterCriteria": {
          "Filters": [
            {
              "Pattern": "{"eventName":["INSERT"],"dynamodb":{"NewImage":{"status":{"S":["pending"]}}}}",
            },
          ],
        },
        "FunctionName": {
          "Ref": "AccountOpeningOutboxProcessorLambda29D6E859",
        },
        "MaximumRetryAttempts": 3,
        "StartingPosition": "LATEST",
      },
      "Type": "AWS::Lambda::EventSourceMapping",
    },
    "AccountOpeningOutboxProcessorLambdaRoleD4592AB4": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-account-opening-outbox-processor:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-account-opening-outbox-processor",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-account-opening-outbox-processor:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "AccountOpeningOutboxProcessorLambdaRoleDefaultPolicyC8FF6E5F": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:Query",
                "dynamodb:Scan",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "AccountOpeningEventStoreD41E30A3",
                    "Arn",
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "AccountOpeningOutboxTable3ABEE0AF",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "AccountOpeningOutboxTable3ABEE0AF",
                          "Arn",
                        ],
                      },
                      "/index/StatusIndex",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "events:PutEvents",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "BankingEventBus7929F6BE",
                  "Arn",
                ],
              },
            },
            {
              "Action": "execute-api:Invoke",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:execute-api:ap-northeast-1:111111111111:",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Ref": "CustomerApiKey38731FBE",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "dynamodb:ListStreams",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "OnlineBankingKmsKey20BDBC63",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "dynamodb:DescribeStream",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "AccountOpeningOutboxTable3ABEE0AF",
                  "StreamArn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "AccountOpeningOutboxProcessorLambdaRoleDefaultPolicyC8FF6E5F",
        "Roles": [
          {
            "Ref": "AccountOpeningOutboxProcessorLambdaRoleD4592AB4",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "AccountOpeningOutboxTable3ABEE0AF": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "id",
            "AttributeType": "S",
          },
          {
            "AttributeName": "timestamp",
            "AttributeType": "S",
          },
          {
            "AttributeName": "status",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "StatusIndex",
            "KeySchema": [
              {
                "AttributeName": "status",
                "KeyType": "HASH",
              },
              {
                "AttributeName": "timestamp",
                "KeyType": "RANGE",
              },
            ],
            "Projection": {
              "ProjectionType": "ALL",
            },
          },
        ],
        "KeySchema": [
          {
            "AttributeName": "id",
            "KeyType": "HASH",
          },
          {
            "AttributeName": "timestamp",
            "KeyType": "RANGE",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "OnlineBankingKmsKey20BDBC63",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
        "StreamSpecification": {
          "StreamViewType": "NEW_AND_OLD_IMAGES",
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Delete",
    },
    "AdminApiKey4943A9E8": {
      "Properties": {
        "Description": "API Key for admin operations",
        "Enabled": true,
        "Name": "admin-api-key",
      },
      "Type": "AWS::ApiGateway::ApiKey",
    },
    "AdminApiKeyParameterE403E849": {
      "Properties": {
        "Description": "Admin API Key value",
        "Name": "/banking-app/api-keys/admin",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "SaveAdminApiKeyValue1468ED09",
            "value",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "AdminApiLambda4D7DC36F": {
      "DependsOn": [
        "AdminApiLambdaRoleDefaultPolicy7CE2B6E9",
        "AdminApiLambdaRole4650266E",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "02f006efd79b7a253e74fcf65264104d2c5ecc6e2f7ce2a82583412f49b1e350.zip",
        },
        "Environment": {
          "Variables": {
            "ACCOUNT_OPENING_EVENT_STORE_TABLE": {
              "Ref": "AccountOpeningEventStoreD41E30A3",
            },
            "EVENT_STORE_TABLE": {
              "Ref": "EventStore165FCE28",
            },
            "NODE_ENV": "production",
          },
        },
        "FunctionName": "online-banking-admin-api",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "AdminApiLambdaRole4650266E",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 30,
      },
      "Type": "AWS::Lambda::Function",
    },
    "AdminApiLambdaRole4650266E": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-admin-api:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-admin-api",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-admin-api:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "AdminApiLambdaRoleDefaultPolicy7CE2B6E9": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:Query",
                "dynamodb:Scan",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "AccountOpeningEventStoreD41E30A3",
                    "Arn",
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "EventStore165FCE28",
                    "Arn",
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "AdminApiLambdaRoleDefaultPolicy7CE2B6E9",
        "Roles": [
          {
            "Ref": "AdminApiLambdaRole4650266E",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "AdminUsagePlan908D4D3D": {
      "Properties": {
        "ApiStages": [
          {
            "ApiId": {
              "Ref": "BankingApi8E314CEB",
            },
            "Stage": {
              "Ref": "BankingApiDeploymentStagev1B20C046B",
            },
            "Throttle": {},
          },
        ],
        "Description": "Usage plan for admin API operations",
        "Quota": {
          "Limit": 5000,
          "Period": "DAY",
        },
        "Throttle": {
          "BurstLimit": 100,
          "RateLimit": 50,
        },
        "UsagePlanName": "admin-usage-plan",
      },
      "Type": "AWS::ApiGateway::UsagePlan",
    },
    "AdminUsagePlanUsagePlanKeyResourceOnlineBankingAppBackendStackAdminApiKey063933F33389082D": {
      "Properties": {
        "KeyId": {
          "Ref": "AdminApiKey4943A9E8",
        },
        "KeyType": "API_KEY",
        "UsagePlanId": {
          "Ref": "AdminUsagePlan908D4D3D",
        },
      },
      "Type": "AWS::ApiGateway::UsagePlanKey",
    },
    "AuthApiKey09F87C70": {
      "Properties": {
        "Description": "API Key for authentication operations",
        "Enabled": true,
        "Name": "auth-api-key",
      },
      "Type": "AWS::ApiGateway::ApiKey",
    },
    "AuthApiKeyParameter236509A9": {
      "Properties": {
        "Description": "Auth API Key value",
        "Name": "/banking-app/api-keys/auth",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "SaveAuthApiKeyValueFFF53435",
            "value",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "AuthUsagePlan59897965": {
      "Properties": {
        "ApiStages": [
          {
            "ApiId": {
              "Ref": "BankingApi8E314CEB",
            },
            "Stage": {
              "Ref": "BankingApiDeploymentStagev1B20C046B",
            },
            "Throttle": {},
          },
        ],
        "Description": "Usage plan for authentication API operations",
        "Quota": {
          "Limit": 20000,
          "Period": "DAY",
        },
        "Throttle": {
          "BurstLimit": 400,
          "RateLimit": 200,
        },
        "UsagePlanName": "auth-usage-plan",
      },
      "Type": "AWS::ApiGateway::UsagePlan",
    },
    "AuthUsagePlanUsagePlanKeyResourceOnlineBankingAppBackendStackAuthApiKey2CEA60367053339C": {
      "Properties": {
        "KeyId": {
          "Ref": "AuthApiKey09F87C70",
        },
        "KeyType": "API_KEY",
        "UsagePlanId": {
          "Ref": "AuthUsagePlan59897965",
        },
      },
      "Type": "AWS::ApiGateway::UsagePlanKey",
    },
    "BalanceLambda9812A5E6": {
      "DependsOn": [
        "BalanceLambdaRoleDefaultPolicyF1BEA135",
        "BalanceLambdaRole4AFEEE54",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "f290f52df00d5b266fd07fb4be536d29eae52b13c1cec54787a10e9f4fafa1c2.zip",
        },
        "Environment": {
          "Variables": {
            "BALANCE_TABLE": {
              "Ref": "BalanceTableF6713123",
            },
            "CORE_API_BASE_URL": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                  },
                  ".execute-api.ap-northeast-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiDeploymentStagev1373CABF394B313B5",
                  },
                  "/",
                ],
              ],
            },
            "CORE_API_KEY_ID": {
              "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
            },
          },
        },
        "FunctionName": "online-banking-balance",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "BalanceLambdaRole4AFEEE54",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 30,
      },
      "Type": "AWS::Lambda::Function",
    },
    "BalanceLambdaRole4AFEEE54": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-balance:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-balance",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-balance:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "BalanceLambdaRoleDefaultPolicyF1BEA135": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:Query",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "BalanceTableF6713123",
                  "Arn",
                ],
              },
            },
            {
              "Action": "execute-api:Invoke",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:execute-api:ap-northeast-1:111111111111:",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
                    },
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "BalanceLambdaRoleDefaultPolicyF1BEA135",
        "Roles": [
          {
            "Ref": "BalanceLambdaRole4AFEEE54",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "BalanceTableF6713123": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "accountId",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "KeySchema": [
          {
            "AttributeName": "accountId",
            "KeyType": "HASH",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "OnlineBankingKmsKey20BDBC63",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Delete",
    },
    "BankingApi8E314CEB": {
      "Properties": {
        "Description": "Online Banking API for mobile apps",
        "Name": "Banking API",
      },
      "Type": "AWS::ApiGateway::RestApi",
    },
    "BankingApiBankingApiRequestValidator7EF3EF31": {
      "Properties": {
        "Name": "banking-api-request-validator",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
        "ValidateRequestBody": true,
        "ValidateRequestParameters": true,
      },
      "Type": "AWS::ApiGateway::RequestValidator",
    },
    "BankingApiCloudWatchRole3D6D63CF": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Policy::arn:<AWS::Partition>:iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs",
              ],
              "id": "AwsSolutions-IAM4",
              "is_reason_encoded": true,
              "reason": "QVBJIEdhdGV3YXnjga5DbG91ZFdhdGNoIExvZ3PjgqLjgq/jgrvjgrnjgavjga/jgIFBV1PjgYzmj5DkvpvjgZnjgovmqJnmupbnmoTjgarnrqHnkIbjg53jg6rjgrfjg7zjgIxBbWF6b25BUElHYXRld2F5UHVzaFRvQ2xvdWRXYXRjaExvZ3PjgI3jgpLkvb/nlKjjgZfjgabjgYTjgb7jgZnjgILjgZPjgozjga9BV1PjgYzmjqjlpajjgZnjgovmlrnms5XjgafjgYLjgorjgIHjgrvjgq3jg6Xjg6rjg4bjgqPkuIrpganliIfjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "apigateway.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Description": "Role for API Gateway to write CloudWatch Logs",
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "BankingApiDeployment8B0123D3f9be396679c7b40a729d36b6d4f229e1": {
      "DependsOn": [
        "BankingApiBankingApiRequestValidator7EF3EF31",
        "BankingApiadminaccountapplicationsapplicationIdcredentialsGETAE6FAF8C",
        "BankingApiadminaccountapplicationsapplicationIdcredentialsOPTIONSC5F7AEA7",
        "BankingApiadminaccountapplicationsapplicationIdcredentialsC469DC60",
        "BankingApiadminaccountapplicationsapplicationIdOPTIONSEEE70534",
        "BankingApiadminaccountapplicationsapplicationId0295F67F",
        "BankingApiadminaccountapplicationsGET78D6A38E",
        "BankingApiadminaccountapplicationsOPTIONS11DE2211",
        "BankingApiadminaccountapplications2E9140B1",
        "BankingApiadminOPTIONS42F0D136",
        "BankingApiadmin0C1D71CB",
        "BankingApiadmintransfereventstransactionIdGETD9508FF4",
        "BankingApiadmintransfereventstransactionIdOPTIONS9822AAA2",
        "BankingApiadmintransfereventstransactionId69285864",
        "BankingApiadmintransfereventsOPTIONS8A4413B5",
        "BankingApiadmintransfereventsE3C7B609",
        "BankingApiapiaccountsidGET32399592",
        "BankingApiapiaccountsidOPTIONS3007EE5E",
        "BankingApiapiaccountsidE21C9ECE",
        "BankingApiapiaccountsidtransactionsGETF9DF35C4",
        "BankingApiapiaccountsidtransactionsOPTIONSF74A2D7C",
        "BankingApiapiaccountsidtransactions9111CB2B",
        "BankingApiapiaccountsconfirmtransactionIdOPTIONSF02D519F",
        "BankingApiapiaccountsconfirmtransactionIdPOST4D64FBDC",
        "BankingApiapiaccountsconfirmtransactionIdrejectOPTIONSD5634EB6",
        "BankingApiapiaccountsconfirmtransactionIdrejectPOST1DE33B3B",
        "BankingApiapiaccountsconfirmtransactionIdrejectC4B9197D",
        "BankingApiapiaccountsconfirmtransactionIdF300DB70",
        "BankingApiapiaccountsconfirmOPTIONSEA178A8E",
        "BankingApiapiaccountsconfirmD8190B6C",
        "BankingApiapiaccountsOPTIONS998530C4",
        "BankingApiapiaccountsPOST9FCECCFE",
        "BankingApiapiaccountsB1BB68F3",
        "BankingApiapiauthloginOPTIONSD8C06810",
        "BankingApiapiauthloginPOST0FB1CDD6",
        "BankingApiapiauthlogin0C925068",
        "BankingApiapiauthOPTIONS6755E77E",
        "BankingApiapiauthF3FC8866",
        "BankingApiapiauthverifyGETD1A4765D",
        "BankingApiapiauthverifyOPTIONS3C380A76",
        "BankingApiapiauthverifyD62AA32C",
        "BankingApiapibalanceGET05E64AEE",
        "BankingApiapibalanceOPTIONS3297DCFF",
        "BankingApiapibalance7EE39FAA",
        "BankingApiapiOPTIONSEEBACE35",
        "BankingApiapi1BF6D74C",
        "BankingApiapitransferOPTIONS8436EBAB",
        "BankingApiapitransferPOST2E3B48C2",
        "BankingApiapitransferAA7A0270",
        "BankingApiapiusersOPTIONS19C087E5",
        "BankingApiapiusersregisterOPTIONS6D193561",
        "BankingApiapiusersregisterPOSTF9ED170E",
        "BankingApiapiusersregister0DF21E6D",
        "BankingApiapiusers1850CC6D",
        "BankingApiOPTIONSECCA8619",
      ],
      "Properties": {
        "Description": "Online Banking API for mobile apps",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Deployment",
    },
    "BankingApiDeploymentStagev1B20C046B": {
      "Properties": {
        "AccessLogSetting": {
          "DestinationArn": {
            "Fn::GetAtt": [
              "BankingApiLogGroup0A0F5C80",
              "Arn",
            ],
          },
          "Format": "{"requestId":"$context.requestId","ip":"$context.identity.sourceIp","user":"$context.identity.user","caller":"$context.identity.caller","requestTime":"$context.requestTime","httpMethod":"$context.httpMethod","resourcePath":"$context.resourcePath","status":"$context.status","protocol":"$context.protocol","responseLength":"$context.responseLength"}",
        },
        "DeploymentId": {
          "Ref": "BankingApiDeployment8B0123D3f9be396679c7b40a729d36b6d4f229e1",
        },
        "MethodSettings": [
          {
            "DataTraceEnabled": true,
            "HttpMethod": "*",
            "LoggingLevel": "INFO",
            "MetricsEnabled": true,
            "ResourcePath": "/*",
          },
        ],
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
        "StageName": "v1",
        "TracingEnabled": true,
      },
      "Type": "AWS::ApiGateway::Stage",
    },
    "BankingApiEndpointParameter6574AF15": {
      "Properties": {
        "Description": "Banking API endpoint",
        "Name": "/banking-app/api-endpoint",
        "Type": "String",
        "Value": {
          "Fn::Join": [
            "",
            [
              "https://",
              {
                "Ref": "BankingApi8E314CEB",
              },
              ".execute-api.ap-northeast-1.",
              {
                "Ref": "AWS::URLSuffix",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/",
            ],
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "BankingApiLogGroup0A0F5C80": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "LogGroupName": "/aws/apigateway/banking-api-OnlineBankingAppBackendStack",
        "RetentionInDays": 30,
      },
      "Type": "AWS::Logs::LogGroup",
      "UpdateReplacePolicy": "Delete",
    },
    "BankingApiOPTIONSECCA8619": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Fn::GetAtt": [
            "BankingApi8E314CEB",
            "RootResourceId",
          ],
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiWebACL": {
      "Properties": {
        "DefaultAction": {
          "Allow": {},
        },
        "Rules": [
          {
            "Action": {
              "Block": {},
            },
            "Name": "RateLimitRule",
            "Priority": 1,
            "Statement": {
              "RateBasedStatement": {
                "AggregateKeyType": "IP",
                "Limit": 2000,
              },
            },
            "VisibilityConfig": {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "RateLimitRule",
              "SampledRequestsEnabled": true,
            },
          },
          {
            "Name": "AWSManagedRulesCommonRuleSet",
            "OverrideAction": {
              "None": {},
            },
            "Priority": 2,
            "Statement": {
              "ManagedRuleGroupStatement": {
                "Name": "AWSManagedRulesCommonRuleSet",
                "VendorName": "AWS",
              },
            },
            "VisibilityConfig": {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "CommonRuleSetMetric",
              "SampledRequestsEnabled": true,
            },
          },
          {
            "Name": "AWSManagedRulesKnownBadInputsRuleSet",
            "OverrideAction": {
              "None": {},
            },
            "Priority": 3,
            "Statement": {
              "ManagedRuleGroupStatement": {
                "Name": "AWSManagedRulesKnownBadInputsRuleSet",
                "VendorName": "AWS",
              },
            },
            "VisibilityConfig": {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "KnownBadInputsRuleSetMetric",
              "SampledRequestsEnabled": true,
            },
          },
          {
            "Name": "AWSManagedRulesLinuxRuleSet",
            "OverrideAction": {
              "None": {},
            },
            "Priority": 4,
            "Statement": {
              "ManagedRuleGroupStatement": {
                "Name": "AWSManagedRulesLinuxRuleSet",
                "VendorName": "AWS",
              },
            },
            "VisibilityConfig": {
              "CloudWatchMetricsEnabled": true,
              "MetricName": "LinuxRuleSetMetric",
              "SampledRequestsEnabled": true,
            },
          },
        ],
        "Scope": "REGIONAL",
        "VisibilityConfig": {
          "CloudWatchMetricsEnabled": true,
          "MetricName": "BankingApiWebACL",
          "SampledRequestsEnabled": true,
        },
      },
      "Type": "AWS::WAFv2::WebACL",
    },
    "BankingApiWebACLArnParameter5B37822C": {
      "Properties": {
        "Description": "Banking API WAF Web ACL ARN",
        "Name": "/banking-app/waf/api-web-acl-arn",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "BankingApiWebACL",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "BankingApiWebACLAssociation": {
      "Properties": {
        "ResourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:aws:apigateway:ap-northeast-1::/restapis/",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/stages/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
            ],
          ],
        },
        "WebACLArn": {
          "Fn::GetAtt": [
            "BankingApiWebACL",
            "Arn",
          ],
        },
      },
      "Type": "AWS::WAFv2::WebACLAssociation",
    },
    "BankingApiadmin0C1D71CB": {
      "Properties": {
        "ParentId": {
          "Fn::GetAtt": [
            "BankingApi8E314CEB",
            "RootResourceId",
          ],
        },
        "PathPart": "admin",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiadminOPTIONS42F0D136": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiadmin0C1D71CB",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiadminaccountapplications2E9140B1": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiadmin0C1D71CB",
        },
        "PathPart": "account-applications",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiadminaccountapplicationsGET78D6A38E": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "NONE",
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "AdminApiLambda4D7DC36F",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "ResourceId": {
          "Ref": "BankingApiadminaccountapplications2E9140B1",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiadminaccountapplicationsGETApiPermissionOnlineBankingAppBackendStackBankingApi3E63800AGETadminaccountapplications1BDECE89": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AdminApiLambda4D7DC36F",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/GET/admin/account-applications",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiadminaccountapplicationsGETApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800AGETadminaccountapplications4B7E3583": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AdminApiLambda4D7DC36F",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/GET/admin/account-applications",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiadminaccountapplicationsOPTIONS11DE2211": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiadminaccountapplications2E9140B1",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiadminaccountapplicationsapplicationId0295F67F": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiadminaccountapplications2E9140B1",
        },
        "PathPart": "{applicationId}",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiadminaccountapplicationsapplicationIdOPTIONSEEE70534": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiadminaccountapplicationsapplicationId0295F67F",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiadminaccountapplicationsapplicationIdcredentialsC469DC60": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiadminaccountapplicationsapplicationId0295F67F",
        },
        "PathPart": "credentials",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiadminaccountapplicationsapplicationIdcredentialsGETAE6FAF8C": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "NONE",
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "AdminApiLambda4D7DC36F",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "RequestParameters": {
          "method.request.path.applicationId": true,
        },
        "ResourceId": {
          "Ref": "BankingApiadminaccountapplicationsapplicationIdcredentialsC469DC60",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiadminaccountapplicationsapplicationIdcredentialsGETApiPermissionOnlineBankingAppBackendStackBankingApi3E63800AGETadminaccountapplicationsapplicationIdcredentials64D317B9": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AdminApiLambda4D7DC36F",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/GET/admin/account-applications/*/credentials",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiadminaccountapplicationsapplicationIdcredentialsGETApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800AGETadminaccountapplicationsapplicationIdcredentialsEAA93E03": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AdminApiLambda4D7DC36F",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/GET/admin/account-applications/*/credentials",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiadminaccountapplicationsapplicationIdcredentialsOPTIONSC5F7AEA7": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiadminaccountapplicationsapplicationIdcredentialsC469DC60",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiadmintransfereventsE3C7B609": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiadmin0C1D71CB",
        },
        "PathPart": "transfer-events",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiadmintransfereventsOPTIONS8A4413B5": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiadmintransfereventsE3C7B609",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiadmintransfereventstransactionId69285864": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiadmintransfereventsE3C7B609",
        },
        "PathPart": "{transactionId}",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiadmintransfereventstransactionIdGETApiPermissionOnlineBankingAppBackendStackBankingApi3E63800AGETadmintransfereventstransactionIdD78B85F1": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AdminApiLambda4D7DC36F",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/GET/admin/transfer-events/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiadmintransfereventstransactionIdGETApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800AGETadmintransfereventstransactionId8A76DAA6": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AdminApiLambda4D7DC36F",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/GET/admin/transfer-events/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiadmintransfereventstransactionIdGETD9508FF4": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "NONE",
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "AdminApiLambda4D7DC36F",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "RequestParameters": {
          "method.request.path.transactionId": true,
        },
        "ResourceId": {
          "Ref": "BankingApiadmintransfereventstransactionId69285864",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiadmintransfereventstransactionIdOPTIONS9822AAA2": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiadmintransfereventstransactionId69285864",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapi1BF6D74C": {
      "Properties": {
        "ParentId": {
          "Fn::GetAtt": [
            "BankingApi8E314CEB",
            "RootResourceId",
          ],
        },
        "PathPart": "api",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapiOPTIONSEEBACE35": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapi1BF6D74C",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiaccountsB1BB68F3": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapi1BF6D74C",
        },
        "PathPart": "accounts",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapiaccountsOPTIONS998530C4": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapiaccountsB1BB68F3",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiaccountsPOST9FCECCFE": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "NONE",
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "AccountOpeningLambdaB96501D4",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "ResourceId": {
          "Ref": "BankingApiapiaccountsB1BB68F3",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiaccountsPOSTApiPermissionOnlineBankingAppBackendStackBankingApi3E63800APOSTapiaccounts460B1E86": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AccountOpeningLambdaB96501D4",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/POST/api/accounts",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiaccountsPOSTApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800APOSTapiaccountsECC54351": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AccountOpeningLambdaB96501D4",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/POST/api/accounts",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiaccountsconfirmD8190B6C": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapiaccountsB1BB68F3",
        },
        "PathPart": "confirm",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapiaccountsconfirmOPTIONSEA178A8E": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapiaccountsconfirmD8190B6C",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiaccountsconfirmtransactionIdF300DB70": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapiaccountsconfirmD8190B6C",
        },
        "PathPart": "{transactionId}",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapiaccountsconfirmtransactionIdOPTIONSF02D519F": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapiaccountsconfirmtransactionIdF300DB70",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiaccountsconfirmtransactionIdPOST4D64FBDC": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "NONE",
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "AccountOpeningLambdaB96501D4",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "RequestParameters": {
          "method.request.path.transactionId": true,
        },
        "ResourceId": {
          "Ref": "BankingApiapiaccountsconfirmtransactionIdF300DB70",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiaccountsconfirmtransactionIdPOSTApiPermissionOnlineBankingAppBackendStackBankingApi3E63800APOSTapiaccountsconfirmtransactionId7803B1E8": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AccountOpeningLambdaB96501D4",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/POST/api/accounts/confirm/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiaccountsconfirmtransactionIdPOSTApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800APOSTapiaccountsconfirmtransactionId75E39661": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AccountOpeningLambdaB96501D4",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/POST/api/accounts/confirm/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiaccountsconfirmtransactionIdrejectC4B9197D": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapiaccountsconfirmtransactionIdF300DB70",
        },
        "PathPart": "reject",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapiaccountsconfirmtransactionIdrejectOPTIONSD5634EB6": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapiaccountsconfirmtransactionIdrejectC4B9197D",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiaccountsconfirmtransactionIdrejectPOST1DE33B3B": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "NONE",
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "AccountOpeningLambdaB96501D4",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "RequestParameters": {
          "method.request.path.transactionId": true,
        },
        "ResourceId": {
          "Ref": "BankingApiapiaccountsconfirmtransactionIdrejectC4B9197D",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiaccountsconfirmtransactionIdrejectPOSTApiPermissionOnlineBankingAppBackendStackBankingApi3E63800APOSTapiaccountsconfirmtransactionIdreject2E3A3286": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AccountOpeningLambdaB96501D4",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/POST/api/accounts/confirm/*/reject",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiaccountsconfirmtransactionIdrejectPOSTApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800APOSTapiaccountsconfirmtransactionIdreject7BBAA48C": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AccountOpeningLambdaB96501D4",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/POST/api/accounts/confirm/*/reject",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiaccountsidE21C9ECE": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapiaccountsB1BB68F3",
        },
        "PathPart": "{id}",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapiaccountsidGET32399592": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "NONE",
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "AccountOpeningLambdaB96501D4",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "RequestParameters": {
          "method.request.path.id": true,
        },
        "ResourceId": {
          "Ref": "BankingApiapiaccountsidE21C9ECE",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiaccountsidGETApiPermissionOnlineBankingAppBackendStackBankingApi3E63800AGETapiaccountsid02302B74": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AccountOpeningLambdaB96501D4",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/GET/api/accounts/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiaccountsidGETApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800AGETapiaccountsidCE329AA1": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "AccountOpeningLambdaB96501D4",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/GET/api/accounts/*",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiaccountsidOPTIONS3007EE5E": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapiaccountsidE21C9ECE",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiaccountsidtransactions9111CB2B": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapiaccountsidE21C9ECE",
        },
        "PathPart": "transactions",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapiaccountsidtransactionsGETApiPermissionOnlineBankingAppBackendStackBankingApi3E63800AGETapiaccountsidtransactions90D69CB6": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "TransactionsLambda59148499",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/GET/api/accounts/*/transactions",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiaccountsidtransactionsGETApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800AGETapiaccountsidtransactions366DA3AC": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "TransactionsLambda59148499",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/GET/api/accounts/*/transactions",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiaccountsidtransactionsGETF9DF35C4": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Ref": "JwtTokenAuthorizerEBD41D2F",
        },
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "TransactionsLambda59148499",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "RequestParameters": {
          "method.request.path.id": true,
        },
        "ResourceId": {
          "Ref": "BankingApiapiaccountsidtransactions9111CB2B",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiaccountsidtransactionsOPTIONSF74A2D7C": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapiaccountsidtransactions9111CB2B",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiauthF3FC8866": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapi1BF6D74C",
        },
        "PathPart": "auth",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapiauthOPTIONS6755E77E": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapiauthF3FC8866",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiauthlogin0C925068": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapiauthF3FC8866",
        },
        "PathPart": "login",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapiauthloginOPTIONSD8C06810": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapiauthlogin0C925068",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiauthloginPOST0FB1CDD6": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "NONE",
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "LoginLambda25499490",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "ResourceId": {
          "Ref": "BankingApiapiauthlogin0C925068",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiauthloginPOSTApiPermissionOnlineBankingAppBackendStackBankingApi3E63800APOSTapiauthloginE3367C9B": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "LoginLambda25499490",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/POST/api/auth/login",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiauthloginPOSTApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800APOSTapiauthloginF6A02C0E": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "LoginLambda25499490",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/POST/api/auth/login",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiauthverifyD62AA32C": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapiauthF3FC8866",
        },
        "PathPart": "verify",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapiauthverifyGETApiPermissionOnlineBankingAppBackendStackBankingApi3E63800AGETapiauthverify621A0DF4": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "VerifyTokenLambda6AB78AA0",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/GET/api/auth/verify",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiauthverifyGETApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800AGETapiauthverify2AB48CCD": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "VerifyTokenLambda6AB78AA0",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/GET/api/auth/verify",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiauthverifyGETD1A4765D": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "NONE",
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "VerifyTokenLambda6AB78AA0",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "ResourceId": {
          "Ref": "BankingApiapiauthverifyD62AA32C",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiauthverifyOPTIONS3C380A76": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapiauthverifyD62AA32C",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapibalance7EE39FAA": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapi1BF6D74C",
        },
        "PathPart": "balance",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapibalanceGET05E64AEE": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Ref": "JwtTokenAuthorizerEBD41D2F",
        },
        "HttpMethod": "GET",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "BalanceLambda9812A5E6",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "ResourceId": {
          "Ref": "BankingApiapibalance7EE39FAA",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapibalanceGETApiPermissionOnlineBankingAppBackendStackBankingApi3E63800AGETapibalanceF4700A38": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "BalanceLambda9812A5E6",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/GET/api/balance",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapibalanceGETApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800AGETapibalanceD4A1DAB5": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "BalanceLambda9812A5E6",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/GET/api/balance",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapibalanceOPTIONS3297DCFF": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapibalance7EE39FAA",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapitransferAA7A0270": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapi1BF6D74C",
        },
        "PathPart": "transfer",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapitransferOPTIONS8436EBAB": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapitransferAA7A0270",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapitransferPOST2E3B48C2": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "CUSTOM",
        "AuthorizerId": {
          "Ref": "JwtTokenAuthorizerEBD41D2F",
        },
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "TransferLambda96F11593",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "ResourceId": {
          "Ref": "BankingApiapitransferAA7A0270",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapitransferPOSTApiPermissionOnlineBankingAppBackendStackBankingApi3E63800APOSTapitransfer7D64F754": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "TransferLambda96F11593",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/POST/api/transfer",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapitransferPOSTApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800APOSTapitransfer2A7536D2": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "TransferLambda96F11593",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/POST/api/transfer",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiusers1850CC6D": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapi1BF6D74C",
        },
        "PathPart": "users",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapiusersOPTIONS19C087E5": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapiusers1850CC6D",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiusersregister0DF21E6D": {
      "Properties": {
        "ParentId": {
          "Ref": "BankingApiapiusers1850CC6D",
        },
        "PathPart": "register",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Resource",
    },
    "BankingApiapiusersregisterOPTIONS6D193561": {
      "Properties": {
        "ApiKeyRequired": false,
        "AuthorizationType": "NONE",
        "HttpMethod": "OPTIONS",
        "Integration": {
          "IntegrationResponses": [
            {
              "ResponseParameters": {
                "method.response.header.Access-Control-Allow-Headers": "'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token,X-Requested-With'",
                "method.response.header.Access-Control-Allow-Methods": "'OPTIONS,GET,PUT,POST,DELETE,PATCH,HEAD'",
                "method.response.header.Access-Control-Allow-Origin": "'*'",
                "method.response.header.Access-Control-Max-Age": "'86400'",
              },
              "StatusCode": "204",
            },
          ],
          "RequestTemplates": {
            "application/json": "{ statusCode: 200 }",
          },
          "Type": "MOCK",
        },
        "MethodResponses": [
          {
            "ResponseParameters": {
              "method.response.header.Access-Control-Allow-Headers": true,
              "method.response.header.Access-Control-Allow-Methods": true,
              "method.response.header.Access-Control-Allow-Origin": true,
              "method.response.header.Access-Control-Max-Age": true,
            },
            "StatusCode": "204",
          },
        ],
        "ResourceId": {
          "Ref": "BankingApiapiusersregister0DF21E6D",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingApiapiusersregisterPOSTApiPermissionOnlineBankingAppBackendStackBankingApi3E63800APOSTapiusersregisterA976BB89": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RegisterLambda5E35AF61",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/",
              {
                "Ref": "BankingApiDeploymentStagev1B20C046B",
              },
              "/POST/api/users/register",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiusersregisterPOSTApiPermissionTestOnlineBankingAppBackendStackBankingApi3E63800APOSTapiusersregisterDE669E3C": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "RegisterLambda5E35AF61",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/test-invoke-stage/POST/api/users/register",
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "BankingApiapiusersregisterPOSTF9ED170E": {
      "Properties": {
        "ApiKeyRequired": true,
        "AuthorizationType": "NONE",
        "HttpMethod": "POST",
        "Integration": {
          "IntegrationHttpMethod": "POST",
          "Type": "AWS_PROXY",
          "Uri": {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":apigateway:ap-northeast-1:lambda:path/2015-03-31/functions/",
                {
                  "Fn::GetAtt": [
                    "RegisterLambda5E35AF61",
                    "Arn",
                  ],
                },
                "/invocations",
              ],
            ],
          },
        },
        "ResourceId": {
          "Ref": "BankingApiapiusersregister0DF21E6D",
        },
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
      },
      "Type": "AWS::ApiGateway::Method",
    },
    "BankingEventBus7929F6BE": {
      "Properties": {
        "Name": "banking-event-bus",
      },
      "Type": "AWS::Events::EventBus",
    },
    "CustomerApiKey38731FBE": {
      "Properties": {
        "Description": "API Key for customer operations (registration, account opening, etc.)",
        "Enabled": true,
        "Name": "customer-api-key",
      },
      "Type": "AWS::ApiGateway::ApiKey",
    },
    "CustomerApiKeyParameterC0C9D112": {
      "Properties": {
        "Description": "Customer API Key value",
        "Name": "/banking-app/api-keys/customer",
        "Type": "String",
        "Value": {
          "Fn::GetAtt": [
            "SaveCustomerApiKeyValue23068704",
            "value",
          ],
        },
      },
      "Type": "AWS::SSM::Parameter",
    },
    "CustomerUsagePlan8E7AC098": {
      "Properties": {
        "ApiStages": [
          {
            "ApiId": {
              "Ref": "BankingApi8E314CEB",
            },
            "Stage": {
              "Ref": "BankingApiDeploymentStagev1B20C046B",
            },
            "Throttle": {},
          },
        ],
        "Description": "Usage plan for customer API operations",
        "Quota": {
          "Limit": 10000,
          "Period": "DAY",
        },
        "Throttle": {
          "BurstLimit": 200,
          "RateLimit": 100,
        },
        "UsagePlanName": "customer-usage-plan",
      },
      "Type": "AWS::ApiGateway::UsagePlan",
    },
    "CustomerUsagePlanUsagePlanKeyResourceOnlineBankingAppBackendStackCustomerApiKey2F75658047805773": {
      "Properties": {
        "KeyId": {
          "Ref": "CustomerApiKey38731FBE",
        },
        "KeyType": "API_KEY",
        "UsagePlanId": {
          "Ref": "CustomerUsagePlan8E7AC098",
        },
      },
      "Type": "AWS::ApiGateway::UsagePlanKey",
    },
    "DefaultUser131CCBEFA": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "DefaultUser1CustomResourcePolicyEEC7F1BD",
        "UsersTable9725E9C8",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"DynamoDB","action":"putItem","parameters":{"TableName":"",
              {
                "Ref": "UsersTable9725E9C8",
              },
              "","Item":{"userId":{"S":"USER001"},"loginId":{"S":"user001"},"customerId":{"S":"CUST001"},"primaryAccountId":{"S":"0011234567"},"email":{"S":"user001@example.com"},"passwordHash":{"S":"$2a$12$l0LvSUoRMdRK9l6UMv/5zuR7kNzzwx.d8VDgZ6OMXZrvB4Z1NVDSq"},"salt":{"S":"$2a$12$LQv3c1yqBWVHxkd0LHAkCO"},"isActive":{"BOOL":true},"loginAttempts":{"N":"0"},"createdAt":{"S":"2025-09-18T00:50:15.000Z"},"updatedAt":{"S":"2025-09-18T00:50:15.000Z"}}},"physicalResourceId":{"id":"default-user-001-v2"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
        "Update": {
          "Fn::Join": [
            "",
            [
              "{"service":"DynamoDB","action":"putItem","parameters":{"TableName":"",
              {
                "Ref": "UsersTable9725E9C8",
              },
              "","Item":{"userId":{"S":"USER001"},"loginId":{"S":"user001"},"customerId":{"S":"CUST001"},"primaryAccountId":{"S":"0011234567"},"email":{"S":"user001@example.com"},"passwordHash":{"S":"$2a$12$l0LvSUoRMdRK9l6UMv/5zuR7kNzzwx.d8VDgZ6OMXZrvB4Z1NVDSq"},"salt":{"S":"$2a$12$LQv3c1yqBWVHxkd0LHAkCO"},"isActive":{"BOOL":true},"loginAttempts":{"N":"0"},"createdAt":{"S":"2025-09-18T00:50:15.000Z"},"updatedAt":{"S":"2025-09-18T00:50:15.000Z"}}},"physicalResourceId":{"id":"default-user-001-v2"}}",
            ],
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "DefaultUser1CustomResourcePolicyEEC7F1BD": {
      "DependsOn": [
        "UsersTable9725E9C8",
      ],
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "dynamodb:PutItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "UsersTable9725E9C8",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
                "kms:DescribeKey",
              ],
              "Condition": {
                "StringEquals": {
                  "kms:ViaService": [
                    "dynamodb.ap-northeast-1.amazonaws.com",
                  ],
                },
              },
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "DefaultUser1CustomResourcePolicyEEC7F1BD",
        "Roles": [
          {
            "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "DefaultUser2791B766D": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "DefaultUser2CustomResourcePolicyE729E6F2",
        "UsersTable9725E9C8",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"DynamoDB","action":"putItem","parameters":{"TableName":"",
              {
                "Ref": "UsersTable9725E9C8",
              },
              "","Item":{"userId":{"S":"USER002"},"loginId":{"S":"user002"},"customerId":{"S":"CUST002"},"primaryAccountId":{"S":"0017654321"},"email":{"S":"user002@example.com"},"passwordHash":{"S":"$2a$12$l0LvSUoRMdRK9l6UMv/5zuR7kNzzwx.d8VDgZ6OMXZrvB4Z1NVDSq"},"salt":{"S":"$2a$12$LQv3c1yqBWVHxkd0LHAkCO"},"isActive":{"BOOL":true},"loginAttempts":{"N":"0"},"createdAt":{"S":"2025-09-18T00:50:15.000Z"},"updatedAt":{"S":"2025-09-18T00:50:15.000Z"}}},"physicalResourceId":{"id":"default-user-002"}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "DefaultUser2CustomResourcePolicyE729E6F2": {
      "DependsOn": [
        "UsersTable9725E9C8",
      ],
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "dynamodb:PutItem",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "UsersTable9725E9C8",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
                "kms:DescribeKey",
              ],
              "Condition": {
                "StringEquals": {
                  "kms:ViaService": [
                    "dynamodb.ap-northeast-1.amazonaws.com",
                  ],
                },
              },
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "DefaultUser2CustomResourcePolicyE729E6F2",
        "Roles": [
          {
            "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "DepositDLQFF5AEA53": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "OnlineBankingKmsKey20BDBC63",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "DepositDLQPolicy193E5813": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "DepositDLQFF5AEA53",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "DepositDLQFF5AEA53",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "DepositEventRuleE4FA6873": {
      "Properties": {
        "EventBusName": {
          "Ref": "BankingEventBus7929F6BE",
        },
        "EventPattern": {
          "detail-type": [
            "DepositRequested",
          ],
          "source": [
            "banking.transfer",
          ],
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "DepositQueue08B81DBD",
                "Arn",
              ],
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "DepositOutboxLambda0E5C6D95": {
      "DependsOn": [
        "DepositOutboxLambdaRoleDefaultPolicyECE9B491",
        "DepositOutboxLambdaRoleDB3E0F08",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "e261e2cec4c99168ebf0ee7f3b26f7a82a4182cac8b99a16e39d93943b719eac.zip",
        },
        "Environment": {
          "Variables": {
            "CORE_API_BASE_URL": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                  },
                  ".execute-api.ap-northeast-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiDeploymentStagev1373CABF394B313B5",
                  },
                  "/",
                ],
              ],
            },
            "CORE_API_KEY_ID": {
              "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
            },
            "EVENT_BUS_NAME": {
              "Ref": "BankingEventBus7929F6BE",
            },
            "EVENT_STORE_TABLE": {
              "Ref": "EventStore165FCE28",
            },
            "OUTBOX_TABLE": {
              "Ref": "OutboxTable0731F305",
            },
          },
        },
        "FunctionName": "online-banking-deposit-outbox",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "DepositOutboxLambdaRoleDB3E0F08",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 60,
      },
      "Type": "AWS::Lambda::Function",
    },
    "DepositOutboxLambdaDynamoDBEventSourceOnlineBankingAppBackendStackOutboxTableE2ADFB651EA7210A": {
      "Properties": {
        "BatchSize": 10,
        "EventSourceArn": {
          "Fn::GetAtt": [
            "OutboxTable0731F305",
            "StreamArn",
          ],
        },
        "FilterCriteria": {
          "Filters": [
            {
              "Pattern": "{"eventName":["INSERT"],"dynamodb":{"NewImage":{"type":{"S":["deposit"]}}}}",
            },
          ],
        },
        "FunctionName": {
          "Ref": "DepositOutboxLambda0E5C6D95",
        },
        "MaximumRetryAttempts": 3,
        "StartingPosition": "LATEST",
      },
      "Type": "AWS::Lambda::EventSourceMapping",
    },
    "DepositOutboxLambdaRoleDB3E0F08": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-deposit-outbox:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-deposit-outbox",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-deposit-outbox:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "DepositOutboxLambdaRoleDefaultPolicyECE9B491": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:Query",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "OutboxTable0731F305",
                    "Arn",
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "EventStore165FCE28",
                    "Arn",
                  ],
                },
              ],
            },
            {
              "Action": "execute-api:Invoke",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:execute-api:ap-northeast-1:111111111111:",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "events:PutEvents",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "BankingEventBus7929F6BE",
                  "Arn",
                ],
              },
            },
            {
              "Action": "dynamodb:ListStreams",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "OnlineBankingKmsKey20BDBC63",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "dynamodb:DescribeStream",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "OutboxTable0731F305",
                  "StreamArn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "DepositOutboxLambdaRoleDefaultPolicyECE9B491",
        "Roles": [
          {
            "Ref": "DepositOutboxLambdaRoleDB3E0F08",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "DepositQueue08B81DBD": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "OnlineBankingKmsKey20BDBC63",
            "Arn",
          ],
        },
        "MessageRetentionPeriod": 1209600,
        "RedrivePolicy": {
          "deadLetterTargetArn": {
            "Fn::GetAtt": [
              "DepositDLQFF5AEA53",
              "Arn",
            ],
          },
          "maxReceiveCount": 3,
        },
        "VisibilityTimeout": 300,
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "DepositQueuePolicyF91727C8": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "DepositQueue08B81DBD",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "sqs:SendMessage",
                "sqs:GetQueueAttributes",
                "sqs:GetQueueUrl",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "DepositQueue08B81DBD",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "DepositQueue08B81DBD",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "DepositWorkerLambda877A0632": {
      "DependsOn": [
        "DepositWorkerLambdaRoleDefaultPolicyE0B82B62",
        "DepositWorkerLambdaRole2385D8C4",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "281361b9473ec0f37777edae6eef7266ec3619fabeb2fd5efac6289d79cc6aeb.zip",
        },
        "Environment": {
          "Variables": {
            "BALANCE_TABLE": {
              "Ref": "BalanceTableF6713123",
            },
            "CORE_API_BASE_URL": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                  },
                  ".execute-api.ap-northeast-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiDeploymentStagev1373CABF394B313B5",
                  },
                  "/",
                ],
              ],
            },
            "CORE_API_KEY_ID": {
              "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
            },
            "EVENT_STORE_TABLE": {
              "Ref": "EventStore165FCE28",
            },
            "OUTBOX_TABLE": {
              "Ref": "OutboxTable0731F305",
            },
          },
        },
        "FunctionName": "online-banking-deposit-worker",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "DepositWorkerLambdaRole2385D8C4",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 60,
      },
      "Type": "AWS::Lambda::Function",
    },
    "DepositWorkerLambdaRole2385D8C4": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-deposit-worker:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-deposit-worker",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-deposit-worker:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "DepositWorkerLambdaRoleDefaultPolicyE0B82B62": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:Query",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "BalanceTableF6713123",
                    "Arn",
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "OutboxTable0731F305",
                    "Arn",
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "EventStore165FCE28",
                    "Arn",
                  ],
                },
              ],
            },
            {
              "Action": "execute-api:Invoke",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:execute-api:ap-northeast-1:111111111111:",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "sqs:ReceiveMessage",
                "sqs:ChangeMessageVisibility",
                "sqs:GetQueueUrl",
                "sqs:DeleteMessage",
                "sqs:GetQueueAttributes",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "DepositQueue08B81DBD",
                  "Arn",
                ],
              },
            },
            {
              "Action": "kms:Decrypt",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "OnlineBankingKmsKey20BDBC63",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "DepositWorkerLambdaRoleDefaultPolicyE0B82B62",
        "Roles": [
          {
            "Ref": "DepositWorkerLambdaRole2385D8C4",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "DepositWorkerLambdaSqsEventSourceOnlineBankingAppBackendStackDepositQueue908D75F7371FCF4B": {
      "Properties": {
        "EventSourceArn": {
          "Fn::GetAtt": [
            "DepositQueue08B81DBD",
            "Arn",
          ],
        },
        "FunctionName": {
          "Ref": "DepositWorkerLambda877A0632",
        },
      },
      "Type": "AWS::Lambda::EventSourceMapping",
    },
    "EventStore165FCE28": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "aggregateId",
            "AttributeType": "S",
          },
          {
            "AttributeName": "version",
            "AttributeType": "N",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "KeySchema": [
          {
            "AttributeName": "aggregateId",
            "KeyType": "HASH",
          },
          {
            "AttributeName": "version",
            "KeyType": "RANGE",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "OnlineBankingKmsKey20BDBC63",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
        "StreamSpecification": {
          "StreamViewType": "NEW_AND_OLD_IMAGES",
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Delete",
    },
    "JwtAuthorizer08CECD9F": {
      "DependsOn": [
        "JwtAuthorizerRoleDefaultPolicy90D4D5D4",
        "JwtAuthorizerRole31D7A21C",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "094055a7ae08fc07ce210273804573105701f0067096ff927eb2d92174697efb.zip",
        },
        "Environment": {
          "Variables": {
            "JWT_SECRET_ARN": {
              "Ref": "JwtSecretB8834B39",
            },
            "NODE_ENV": "production",
            "SESSIONS_TABLE": {
              "Ref": "SessionsTable7C302024",
            },
            "USERS_TABLE": {
              "Ref": "UsersTable9725E9C8",
            },
          },
        },
        "FunctionName": "online-banking-jwt-authorizer",
        "Handler": "index.handler",
        "KmsKeyArn": {
          "Fn::GetAtt": [
            "OnlineBankingKmsKey20BDBC63",
            "Arn",
          ],
        },
        "Role": {
          "Fn::GetAtt": [
            "JwtAuthorizerRole31D7A21C",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 10,
      },
      "Type": "AWS::Lambda::Function",
    },
    "JwtAuthorizerOnlineBankingAppBackendStackJwtTokenAuthorizerBAD961FDPermissionsD592A2D4": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "JwtAuthorizer08CECD9F",
            "Arn",
          ],
        },
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition",
              },
              ":execute-api:ap-northeast-1:111111111111:",
              {
                "Ref": "BankingApi8E314CEB",
              },
              "/authorizers/",
              {
                "Ref": "JwtTokenAuthorizerEBD41D2F",
              },
            ],
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "JwtAuthorizerRole31D7A21C": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-jwt-authorizer:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-jwt-authorizer",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-jwt-authorizer:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "JwtAuthorizerRoleDefaultPolicy90D4D5D4": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:Query",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "UsersTable9725E9C8",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UsersTable9725E9C8",
                          "Arn",
                        ],
                      },
                      "/index/CustomerIdIndex",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UsersTable9725E9C8",
                          "Arn",
                        ],
                      },
                      "/index/LoginIdIndex",
                    ],
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "SessionsTable7C302024",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "SessionsTable7C302024",
                          "Arn",
                        ],
                      },
                      "/index/UserIdIndex",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "JwtSecretB8834B39",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "JwtAuthorizerRoleDefaultPolicy90D4D5D4",
        "Roles": [
          {
            "Ref": "JwtAuthorizerRole31D7A21C",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "JwtSecretB8834B39": {
      "DeletionPolicy": "Delete",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-SMG4",
              "is_reason_encoded": true,
              "reason": "SldU572y5ZCN6Y2144Gu6Ieq5YuV44Ot44O844OG44O844K344On44Oz44Gv5pei5a2Y44Gu44OI44O844Kv44Oz44KS54Sh5Yq55YyW44GZ44KL44Gf44KB44CB44K744Kt44Ol44Oq44OG44Kj44Od44Oq44K344O844Gr5Z+644Gl44GE44Gm5omL5YuV44Gn566h55CG44GX44G+44GZ44CC6YeR6J6N44K344K544OG44Og44Gn44Gv5LqI5pyf44GX44Gq44GE44OI44O844Kv44Oz54Sh5Yq55YyW44KS6YG/44GR44KL44Gf44KB44CB6KiI55S755qE44Gq44Ot44O844OG44O844K344On44Oz44GM5b+F6KaB44Gn44GZ44CC",
            },
          ],
        },
      },
      "Properties": {
        "Description": "JWT signing secret for banking application",
        "GenerateSecretString": {
          "ExcludeCharacters": ""@/\\'",
          "GenerateStringKey": "password",
          "PasswordLength": 64,
          "SecretStringTemplate": "{"username":"banking-app"}",
        },
      },
      "Type": "AWS::SecretsManager::Secret",
      "UpdateReplacePolicy": "Delete",
    },
    "JwtTokenAuthorizerEBD41D2F": {
      "Properties": {
        "AuthorizerResultTtlInSeconds": 300,
        "AuthorizerUri": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Fn::Select": [
                  1,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "JwtAuthorizer08CECD9F",
                          "Arn",
                        ],
                      },
                    ],
                  },
                ],
              },
              ":apigateway:",
              {
                "Fn::Select": [
                  3,
                  {
                    "Fn::Split": [
                      ":",
                      {
                        "Fn::GetAtt": [
                          "JwtAuthorizer08CECD9F",
                          "Arn",
                        ],
                      },
                    ],
                  },
                ],
              },
              ":lambda:path/2015-03-31/functions/",
              {
                "Fn::GetAtt": [
                  "JwtAuthorizer08CECD9F",
                  "Arn",
                ],
              },
              "/invocations",
            ],
          ],
        },
        "IdentitySource": "method.request.header.Authorization",
        "Name": "jwt-authorizer",
        "RestApiId": {
          "Ref": "BankingApi8E314CEB",
        },
        "Type": "TOKEN",
      },
      "Type": "AWS::ApiGateway::Authorizer",
    },
    "LoginLambda25499490": {
      "DependsOn": [
        "LoginLambdaRoleDefaultPolicy807FE9A5",
        "LoginLambdaRole4C8D9B6A",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "4232fba80aac174478687b28e741a1143b6da92ed697b25a90e6502a6e6fa87a.zip",
        },
        "Environment": {
          "Variables": {
            "JWT_SECRET_ARN": {
              "Ref": "JwtSecretB8834B39",
            },
            "NODE_ENV": "production",
            "SESSIONS_TABLE": {
              "Ref": "SessionsTable7C302024",
            },
            "USERS_TABLE": {
              "Ref": "UsersTable9725E9C8",
            },
          },
        },
        "FunctionName": "online-banking-login",
        "Handler": "index.handler",
        "KmsKeyArn": {
          "Fn::GetAtt": [
            "OnlineBankingKmsKey20BDBC63",
            "Arn",
          ],
        },
        "Role": {
          "Fn::GetAtt": [
            "LoginLambdaRole4C8D9B6A",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 30,
      },
      "Type": "AWS::Lambda::Function",
    },
    "LoginLambdaRole4C8D9B6A": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-login:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-login",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-login:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "LoginLambdaRoleDefaultPolicy807FE9A5": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "JwtSecretB8834B39",
              },
            },
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:Query",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "UsersTable9725E9C8",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UsersTable9725E9C8",
                          "Arn",
                        ],
                      },
                      "/index/CustomerIdIndex",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UsersTable9725E9C8",
                          "Arn",
                        ],
                      },
                      "/index/LoginIdIndex",
                    ],
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "SessionsTable7C302024",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "SessionsTable7C302024",
                          "Arn",
                        ],
                      },
                      "/index/UserIdIndex",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "LoginLambdaRoleDefaultPolicy807FE9A5",
        "Roles": [
          {
            "Ref": "LoginLambdaRole4C8D9B6A",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "MailNotificationLambda1EE8848A": {
      "DependsOn": [
        "MailNotificationLambdaRoleDefaultPolicyA999FAA7",
        "MailNotificationLambdaRole680648FB",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "13287d5468fafc9451de9366f51b14e5ff167f2ca4fe40f96b71bebaa1ded1ab.zip",
        },
        "Environment": {
          "Variables": {
            "CORE_API_BASE_URL": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                  },
                  ".execute-api.ap-northeast-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiDeploymentStagev1373CABF394B313B5",
                  },
                  "/",
                ],
              ],
            },
            "CORE_API_KEY_ID": {
              "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
            },
            "MAIL_DELIVERY_API": "https://your-mail-delivery-api.com/api/v1",
            "MAIL_DELIVERY_API_KEY": "",
          },
        },
        "FunctionName": "online-banking-mail-notification",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "MailNotificationLambdaRole680648FB",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 30,
      },
      "Type": "AWS::Lambda::Function",
    },
    "MailNotificationLambdaRole680648FB": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-mail-notification:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-mail-notification",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-mail-notification:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "MailNotificationLambdaRoleDefaultPolicyA999FAA7": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "execute-api:Invoke",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:execute-api:ap-northeast-1:111111111111:",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
                    },
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "MailNotificationLambdaRoleDefaultPolicyA999FAA7",
        "Roles": [
          {
            "Ref": "MailNotificationLambdaRole680648FB",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "OnlineBankingKmsKey20BDBC63": {
      "DeletionPolicy": "Delete",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-KMS5",
              "is_reason_encoded": true,
              "reason": "S01T44Kt44O844Od44Oq44K344O844Gn44Gv44CB44Kt44O8566h55CG44Go44OH44O844K/44Ki44Kv44K744K544Gu6IG35o6M5YiG6Zui44KS5a6f54++44GZ44KL44Gf44KB44CB6YGp5YiH44Gq44OX44Oq44Oz44K344OR44Or44Gr5a++44GX44Gm44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44KS5LuY5LiO44GX44Gm44GE44G+44GZ44CC44GT44KM44GvRklTQ+WuieWFqOWvvuetluWfuua6luOBruaal+WPt+WMlumNteeuoeeQhuimgeS7tuOBq+a6luaLoOOBl+OBn+ioreioiOOBp+OBmeOAgg==",
            },
          ],
        },
      },
      "Properties": {
        "Description": "Online Banking App encryption key for FISC compliance",
        "EnableKeyRotation": true,
        "KeyPolicy": {
          "Statement": [
            {
              "Action": "kms:*",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::111111111111:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
              "Sid": "EnableRootAccountAccess",
            },
            {
              "Action": [
                "kms:Create*",
                "kms:Describe*",
                "kms:Enable*",
                "kms:List*",
                "kms:Put*",
                "kms:Update*",
                "kms:Revoke*",
                "kms:Disable*",
                "kms:Get*",
                "kms:Delete*",
                "kms:TagResource",
                "kms:UntagResource",
                "kms:ScheduleKeyDeletion",
                "kms:CancelKeyDeletion",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": "cloudformation.amazonaws.com",
              },
              "Resource": "*",
              "Sid": "AllowKeyAdministration",
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "dynamodb.amazonaws.com",
                  "s3.amazonaws.com",
                  "lambda.amazonaws.com",
                  "sqs.amazonaws.com",
                  "logs.amazonaws.com",
                ],
              },
              "Resource": "*",
              "Sid": "AllowKeyUsage",
            },
            {
              "Action": [
                "kms:CreateGrant",
                "kms:ListGrants",
                "kms:RevokeGrant",
              ],
              "Condition": {
                "Bool": {
                  "kms:GrantIsForAWSResource": "true",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "dynamodb.amazonaws.com",
                  "s3.amazonaws.com",
                  "lambda.amazonaws.com",
                  "sqs.amazonaws.com",
                  "logs.amazonaws.com",
                ],
              },
              "Resource": "*",
              "Sid": "AllowAttachmentOfPersistentResources",
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
                "kms:DescribeKey",
              ],
              "Condition": {
                "StringEquals": {
                  "kms:ViaService": [
                    "dynamodb.ap-northeast-1.amazonaws.com",
                  ],
                },
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::111111111111:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
              "Sid": "AllowCustomResourceAccess",
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
                "kms:DescribeKey",
              ],
              "Condition": {
                "StringEquals": {
                  "aws:SourceAccount": "111111111111",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
              "Resource": "*",
              "Sid": "AllowLambdaDirectAccess",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PendingWindowInDays": 30,
        "Tags": [
          {
            "Key": "Environment",
            "Value": "OnlineBankingAppBackendStack",
          },
          {
            "Key": "KeyRotation",
            "Value": "Enabled",
          },
          {
            "Key": "Purpose",
            "Value": "FISC-Compliance",
          },
        ],
      },
      "Type": "AWS::KMS::Key",
      "UpdateReplacePolicy": "Delete",
    },
    "OnlineBankingKmsKeyAlias65BF1F3D": {
      "Properties": {
        "AliasName": "alias/online-banking-app",
        "TargetKeyId": {
          "Fn::GetAtt": [
            "OnlineBankingKmsKey20BDBC63",
            "Arn",
          ],
        },
      },
      "Type": "AWS::KMS::Alias",
    },
    "OutboxTable0731F305": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "id",
            "AttributeType": "S",
          },
          {
            "AttributeName": "timestamp",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "KeySchema": [
          {
            "AttributeName": "id",
            "KeyType": "HASH",
          },
          {
            "AttributeName": "timestamp",
            "KeyType": "RANGE",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "OnlineBankingKmsKey20BDBC63",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
        "StreamSpecification": {
          "StreamViewType": "NEW_AND_OLD_IMAGES",
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Delete",
    },
    "RegisterLambda5E35AF61": {
      "DependsOn": [
        "RegisterLambdaRoleDefaultPolicy09557B20",
        "RegisterLambdaRoleA471BD4F",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "e7899539e2d1e40f17a6e372ae6090ebf5444dc02e03b02dd367e4d607b2f1f6.zip",
        },
        "Environment": {
          "Variables": {
            "JWT_SECRET_ARN": {
              "Ref": "JwtSecretB8834B39",
            },
            "NODE_ENV": "production",
            "USERS_TABLE": {
              "Ref": "UsersTable9725E9C8",
            },
          },
        },
        "FunctionName": "online-banking-register",
        "Handler": "index.handler",
        "KmsKeyArn": {
          "Fn::GetAtt": [
            "OnlineBankingKmsKey20BDBC63",
            "Arn",
          ],
        },
        "Role": {
          "Fn::GetAtt": [
            "RegisterLambdaRoleA471BD4F",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 30,
      },
      "Type": "AWS::Lambda::Function",
    },
    "RegisterLambdaRoleA471BD4F": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-register:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-register",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-register:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "RegisterLambdaRoleDefaultPolicy09557B20": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "JwtSecretB8834B39",
              },
            },
            {
              "Action": [
                "dynamodb:PutItem",
                "dynamodb:Query",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "UsersTable9725E9C8",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UsersTable9725E9C8",
                          "Arn",
                        ],
                      },
                      "/index/CustomerIdIndex",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UsersTable9725E9C8",
                          "Arn",
                        ],
                      },
                      "/index/LoginIdIndex",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "RegisterLambdaRoleDefaultPolicy09557B20",
        "Roles": [
          {
            "Ref": "RegisterLambdaRoleA471BD4F",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "SaveAdminApiKeyValue1468ED09": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "SaveAdminApiKeyValueCustomResourcePolicy2CD0A18F",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"APIGateway","action":"getApiKey","parameters":{"apiKey":"",
              {
                "Ref": "AdminApiKey4943A9E8",
              },
              "","includeValue":true},"physicalResourceId":{"id":"save-admin-api-key-",
              {
                "Ref": "AdminApiKey4943A9E8",
              },
              ""}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
        "Update": {
          "Fn::Join": [
            "",
            [
              "{"service":"APIGateway","action":"getApiKey","parameters":{"apiKey":"",
              {
                "Ref": "AdminApiKey4943A9E8",
              },
              "","includeValue":true},"physicalResourceId":{"id":"save-admin-api-key-",
              {
                "Ref": "AdminApiKey4943A9E8",
              },
              ""}}",
            ],
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "SaveAdminApiKeyValueCustomResourcePolicy2CD0A18F": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Ref": "AdminApiKey4943A9E8",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "ssm:PutParameter",
              "Effect": "Allow",
              "Resource": "arn:aws:ssm:ap-northeast-1:111111111111:parameter/banking-app/api-keys/admin",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "SaveAdminApiKeyValueCustomResourcePolicy2CD0A18F",
        "Roles": [
          {
            "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "SaveAuthApiKeyValueCustomResourcePolicyD06A7E0C": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Ref": "AuthApiKey09F87C70",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "ssm:PutParameter",
              "Effect": "Allow",
              "Resource": "arn:aws:ssm:ap-northeast-1:111111111111:parameter/banking-app/api-keys/auth",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "SaveAuthApiKeyValueCustomResourcePolicyD06A7E0C",
        "Roles": [
          {
            "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "SaveAuthApiKeyValueFFF53435": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "SaveAuthApiKeyValueCustomResourcePolicyD06A7E0C",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"APIGateway","action":"getApiKey","parameters":{"apiKey":"",
              {
                "Ref": "AuthApiKey09F87C70",
              },
              "","includeValue":true},"physicalResourceId":{"id":"save-auth-api-key-",
              {
                "Ref": "AuthApiKey09F87C70",
              },
              ""}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
        "Update": {
          "Fn::Join": [
            "",
            [
              "{"service":"APIGateway","action":"getApiKey","parameters":{"apiKey":"",
              {
                "Ref": "AuthApiKey09F87C70",
              },
              "","includeValue":true},"physicalResourceId":{"id":"save-auth-api-key-",
              {
                "Ref": "AuthApiKey09F87C70",
              },
              ""}}",
            ],
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "SaveCustomerApiKeyValue23068704": {
      "DeletionPolicy": "Delete",
      "DependsOn": [
        "SaveCustomerApiKeyValueCustomResourcePolicy93BC0C21",
      ],
      "Properties": {
        "Create": {
          "Fn::Join": [
            "",
            [
              "{"service":"APIGateway","action":"getApiKey","parameters":{"apiKey":"",
              {
                "Ref": "CustomerApiKey38731FBE",
              },
              "","includeValue":true},"physicalResourceId":{"id":"save-customer-api-key-",
              {
                "Ref": "CustomerApiKey38731FBE",
              },
              ""}}",
            ],
          ],
        },
        "InstallLatestAwsSdk": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "AWS679f53fac002430cb0da5b7982bd22872D164C4C",
            "Arn",
          ],
        },
        "Update": {
          "Fn::Join": [
            "",
            [
              "{"service":"APIGateway","action":"getApiKey","parameters":{"apiKey":"",
              {
                "Ref": "CustomerApiKey38731FBE",
              },
              "","includeValue":true},"physicalResourceId":{"id":"save-customer-api-key-",
              {
                "Ref": "CustomerApiKey38731FBE",
              },
              ""}}",
            ],
          ],
        },
      },
      "Type": "Custom::AWS",
      "UpdateReplacePolicy": "Delete",
    },
    "SaveCustomerApiKeyValueCustomResourcePolicy93BC0C21": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Ref": "CustomerApiKey38731FBE",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "ssm:PutParameter",
              "Effect": "Allow",
              "Resource": "arn:aws:ssm:ap-northeast-1:111111111111:parameter/banking-app/api-keys/customer",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "SaveCustomerApiKeyValueCustomResourcePolicy93BC0C21",
        "Roles": [
          {
            "Ref": "AWS679f53fac002430cb0da5b7982bd2287ServiceRoleC1EA0FF2",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "SessionsTable7C302024": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "sessionId",
            "AttributeType": "S",
          },
          {
            "AttributeName": "userId",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "UserIdIndex",
            "KeySchema": [
              {
                "AttributeName": "userId",
                "KeyType": "HASH",
              },
            ],
            "Projection": {
              "ProjectionType": "ALL",
            },
          },
        ],
        "KeySchema": [
          {
            "AttributeName": "sessionId",
            "KeyType": "HASH",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "OnlineBankingKmsKey20BDBC63",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
        "TimeToLiveSpecification": {
          "AttributeName": "expiresAt",
          "Enabled": true,
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Delete",
    },
    "TransactionsLambda59148499": {
      "DependsOn": [
        "TransactionsLambdaRoleDefaultPolicy5011FD6B",
        "TransactionsLambdaRole6C1F59BE",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "364a6b070f50cd0ea212a173b32d9a180b6ac897110705b7d54d9dae0487b54d.zip",
        },
        "Environment": {
          "Variables": {
            "CORE_API_BASE_URL": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                  },
                  ".execute-api.ap-northeast-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiDeploymentStagev1373CABF394B313B5",
                  },
                  "/",
                ],
              ],
            },
            "CORE_API_KEY_ID": {
              "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
            },
          },
        },
        "FunctionName": "online-banking-transactions",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "TransactionsLambdaRole6C1F59BE",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 30,
      },
      "Type": "AWS::Lambda::Function",
    },
    "TransactionsLambdaRole6C1F59BE": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-transactions:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-transactions",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-transactions:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "TransactionsLambdaRoleDefaultPolicy5011FD6B": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "execute-api:Invoke",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:execute-api:ap-northeast-1:111111111111:",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
                    },
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TransactionsLambdaRoleDefaultPolicy5011FD6B",
        "Roles": [
          {
            "Ref": "TransactionsLambdaRole6C1F59BE",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "TransferCompletedEventRuleAllowEventRuleOnlineBankingAppBackendStackMailNotificationLambda2E628E678E78B5F3": {
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "MailNotificationLambda1EE8848A",
            "Arn",
          ],
        },
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::GetAtt": [
            "TransferCompletedEventRuleE61E472E",
            "Arn",
          ],
        },
      },
      "Type": "AWS::Lambda::Permission",
    },
    "TransferCompletedEventRuleE61E472E": {
      "Properties": {
        "EventBusName": {
          "Ref": "BankingEventBus7929F6BE",
        },
        "EventPattern": {
          "detail-type": [
            "TransferCompleted",
          ],
          "source": [
            "banking.transfer",
          ],
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "MailNotificationLambda1EE8848A",
                "Arn",
              ],
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "TransferLambda96F11593": {
      "DependsOn": [
        "TransferLambdaRoleDefaultPolicy163CC5A3",
        "TransferLambdaRoleFC580EB8",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "faf53b03a5af4e96ccec3c6c8f4c62152e59528baf96d72eca0fc46addc60ce0.zip",
        },
        "Environment": {
          "Variables": {
            "BALANCE_TABLE": {
              "Ref": "BalanceTableF6713123",
            },
            "CORE_API_BASE_URL": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                  },
                  ".execute-api.ap-northeast-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiDeploymentStagev1373CABF394B313B5",
                  },
                  "/",
                ],
              ],
            },
            "CORE_API_KEY_ID": {
              "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
            },
            "EVENT_BUS_NAME": {
              "Ref": "BankingEventBus7929F6BE",
            },
            "EVENT_STORE_TABLE": {
              "Ref": "EventStore165FCE28",
            },
            "OUTBOX_TABLE": {
              "Ref": "OutboxTable0731F305",
            },
          },
        },
        "FunctionName": "online-banking-transfer",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "TransferLambdaRoleFC580EB8",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 30,
      },
      "Type": "AWS::Lambda::Function",
    },
    "TransferLambdaRoleDefaultPolicy163CC5A3": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:PutItem",
                "dynamodb:GetItem",
                "dynamodb:Query",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "EventStore165FCE28",
                    "Arn",
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "OutboxTable0731F305",
                    "Arn",
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "BalanceTableF6713123",
                    "Arn",
                  ],
                },
              ],
            },
            {
              "Action": "execute-api:Invoke",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:execute-api:ap-northeast-1:111111111111:",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "events:PutEvents",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "BankingEventBus7929F6BE",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "TransferLambdaRoleDefaultPolicy163CC5A3",
        "Roles": [
          {
            "Ref": "TransferLambdaRoleFC580EB8",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "TransferLambdaRoleFC580EB8": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-transfer:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-transfer",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-transfer:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "UsersTable9725E9C8": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "AttributeDefinitions": [
          {
            "AttributeName": "userId",
            "AttributeType": "S",
          },
          {
            "AttributeName": "customerId",
            "AttributeType": "S",
          },
          {
            "AttributeName": "loginId",
            "AttributeType": "S",
          },
        ],
        "BillingMode": "PAY_PER_REQUEST",
        "GlobalSecondaryIndexes": [
          {
            "IndexName": "CustomerIdIndex",
            "KeySchema": [
              {
                "AttributeName": "customerId",
                "KeyType": "HASH",
              },
            ],
            "Projection": {
              "ProjectionType": "ALL",
            },
          },
          {
            "IndexName": "LoginIdIndex",
            "KeySchema": [
              {
                "AttributeName": "loginId",
                "KeyType": "HASH",
              },
            ],
            "Projection": {
              "ProjectionType": "ALL",
            },
          },
        ],
        "KeySchema": [
          {
            "AttributeName": "userId",
            "KeyType": "HASH",
          },
        ],
        "PointInTimeRecoverySpecification": {
          "PointInTimeRecoveryEnabled": true,
        },
        "SSESpecification": {
          "KMSMasterKeyId": {
            "Fn::GetAtt": [
              "OnlineBankingKmsKey20BDBC63",
              "Arn",
            ],
          },
          "SSEEnabled": true,
          "SSEType": "KMS",
        },
      },
      "Type": "AWS::DynamoDB::Table",
      "UpdateReplacePolicy": "Delete",
    },
    "VerifyTokenLambda6AB78AA0": {
      "DependsOn": [
        "VerifyTokenLambdaRoleDefaultPolicy65AD9234",
        "VerifyTokenLambdaRole34FBE555",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "d31db85687ccded962fe6d6d622dab331c03dff6bbc652b62e1c7577c143e924.zip",
        },
        "Environment": {
          "Variables": {
            "JWT_SECRET_ARN": {
              "Ref": "JwtSecretB8834B39",
            },
            "NODE_ENV": "production",
            "SESSIONS_TABLE": {
              "Ref": "SessionsTable7C302024",
            },
            "USERS_TABLE": {
              "Ref": "UsersTable9725E9C8",
            },
          },
        },
        "FunctionName": "online-banking-verify-token",
        "Handler": "index.handler",
        "KmsKeyArn": {
          "Fn::GetAtt": [
            "OnlineBankingKmsKey20BDBC63",
            "Arn",
          ],
        },
        "Role": {
          "Fn::GetAtt": [
            "VerifyTokenLambdaRole34FBE555",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 10,
      },
      "Type": "AWS::Lambda::Function",
    },
    "VerifyTokenLambdaRole34FBE555": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-verify-token:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-verify-token",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-verify-token:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "VerifyTokenLambdaRoleDefaultPolicy65AD9234": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "secretsmanager:GetSecretValue",
                "secretsmanager:DescribeSecret",
              ],
              "Effect": "Allow",
              "Resource": {
                "Ref": "JwtSecretB8834B39",
              },
            },
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:Query",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "UsersTable9725E9C8",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UsersTable9725E9C8",
                          "Arn",
                        ],
                      },
                      "/index/CustomerIdIndex",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "UsersTable9725E9C8",
                          "Arn",
                        ],
                      },
                      "/index/LoginIdIndex",
                    ],
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "SessionsTable7C302024",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "SessionsTable7C302024",
                          "Arn",
                        ],
                      },
                      "/index/UserIdIndex",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "VerifyTokenLambdaRoleDefaultPolicy65AD9234",
        "Roles": [
          {
            "Ref": "VerifyTokenLambdaRole34FBE555",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "WithdrawDLQ8DFEC48A": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "OnlineBankingKmsKey20BDBC63",
            "Arn",
          ],
        },
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "WithdrawDLQPolicy6E980250": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "WithdrawDLQ8DFEC48A",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "WithdrawDLQ8DFEC48A",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "WithdrawEventRuleB9C2F038": {
      "Properties": {
        "EventBusName": {
          "Ref": "BankingEventBus7929F6BE",
        },
        "EventPattern": {
          "detail-type": [
            "WithdrawRequested",
          ],
          "source": [
            "banking.transfer",
          ],
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "WithdrawQueueD317226A",
                "Arn",
              ],
            },
            "Id": "Target0",
          },
        ],
      },
      "Type": "AWS::Events::Rule",
    },
    "WithdrawOutboxLambda58767575": {
      "DependsOn": [
        "WithdrawOutboxLambdaRoleDefaultPolicy90ED705F",
        "WithdrawOutboxLambdaRoleC9B30236",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "63edb5540e127031d11b66328f9604bd6af1bbc6b7b66f748b25b258beefba3d.zip",
        },
        "Environment": {
          "Variables": {
            "CORE_API_BASE_URL": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                  },
                  ".execute-api.ap-northeast-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiDeploymentStagev1373CABF394B313B5",
                  },
                  "/",
                ],
              ],
            },
            "CORE_API_KEY_ID": {
              "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
            },
            "EVENT_BUS_NAME": {
              "Ref": "BankingEventBus7929F6BE",
            },
            "EVENT_STORE_TABLE": {
              "Ref": "EventStore165FCE28",
            },
            "OUTBOX_TABLE": {
              "Ref": "OutboxTable0731F305",
            },
          },
        },
        "FunctionName": "online-banking-withdraw-outbox",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "WithdrawOutboxLambdaRoleC9B30236",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 60,
      },
      "Type": "AWS::Lambda::Function",
    },
    "WithdrawOutboxLambdaDynamoDBEventSourceOnlineBankingAppBackendStackOutboxTableE2ADFB651CDD87DF": {
      "Properties": {
        "BatchSize": 10,
        "EventSourceArn": {
          "Fn::GetAtt": [
            "OutboxTable0731F305",
            "StreamArn",
          ],
        },
        "FilterCriteria": {
          "Filters": [
            {
              "Pattern": "{"eventName":["INSERT"],"dynamodb":{"NewImage":{"type":{"S":["withdraw"]}}}}",
            },
          ],
        },
        "FunctionName": {
          "Ref": "WithdrawOutboxLambda58767575",
        },
        "MaximumRetryAttempts": 3,
        "StartingPosition": "LATEST",
      },
      "Type": "AWS::Lambda::EventSourceMapping",
    },
    "WithdrawOutboxLambdaRoleC9B30236": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-withdraw-outbox:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-withdraw-outbox",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-withdraw-outbox:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "WithdrawOutboxLambdaRoleDefaultPolicy90ED705F": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:Query",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "OutboxTable0731F305",
                    "Arn",
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "EventStore165FCE28",
                    "Arn",
                  ],
                },
              ],
            },
            {
              "Action": "execute-api:Invoke",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:execute-api:ap-northeast-1:111111111111:",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
                    },
                  ],
                ],
              },
            },
            {
              "Action": "events:PutEvents",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "BankingEventBus7929F6BE",
                  "Arn",
                ],
              },
            },
            {
              "Action": "dynamodb:ListStreams",
              "Effect": "Allow",
              "Resource": "*",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "OnlineBankingKmsKey20BDBC63",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "dynamodb:DescribeStream",
                "dynamodb:GetRecords",
                "dynamodb:GetShardIterator",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "OutboxTable0731F305",
                  "StreamArn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "WithdrawOutboxLambdaRoleDefaultPolicy90ED705F",
        "Roles": [
          {
            "Ref": "WithdrawOutboxLambdaRoleC9B30236",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "WithdrawQueueD317226A": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "KmsMasterKeyId": {
          "Fn::GetAtt": [
            "OnlineBankingKmsKey20BDBC63",
            "Arn",
          ],
        },
        "MessageRetentionPeriod": 1209600,
        "RedrivePolicy": {
          "deadLetterTargetArn": {
            "Fn::GetAtt": [
              "WithdrawDLQ8DFEC48A",
              "Arn",
            ],
          },
          "maxReceiveCount": 3,
        },
        "VisibilityTimeout": 300,
      },
      "Type": "AWS::SQS::Queue",
      "UpdateReplacePolicy": "Delete",
    },
    "WithdrawQueuePolicy3B34709D": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "sqs:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "WithdrawQueueD317226A",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "sqs:SendMessage",
                "sqs:GetQueueAttributes",
                "sqs:GetQueueUrl",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": "events.amazonaws.com",
              },
              "Resource": {
                "Fn::GetAtt": [
                  "WithdrawQueueD317226A",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Queues": [
          {
            "Ref": "WithdrawQueueD317226A",
          },
        ],
      },
      "Type": "AWS::SQS::QueuePolicy",
    },
    "WithdrawWorkerLambda38C73BB9": {
      "DependsOn": [
        "WithdrawWorkerLambdaRoleDefaultPolicyDE4942E2",
        "WithdrawWorkerLambdaRoleCD38C408",
      ],
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "23c4206649db06f094d74cb25e11b6cf7dc5b9156ff46f78ad9d2cd948e91740.zip",
        },
        "Environment": {
          "Variables": {
            "BALANCE_TABLE": {
              "Ref": "BalanceTableF6713123",
            },
            "CORE_API_BASE_URL": {
              "Fn::Join": [
                "",
                [
                  "https://",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                  },
                  ".execute-api.ap-northeast-1.",
                  {
                    "Ref": "AWS::URLSuffix",
                  },
                  "/",
                  {
                    "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiDeploymentStagev1373CABF394B313B5",
                  },
                  "/",
                ],
              ],
            },
            "CORE_API_KEY_ID": {
              "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
            },
            "EVENT_STORE_TABLE": {
              "Ref": "EventStore165FCE28",
            },
            "OUTBOX_TABLE": {
              "Ref": "OutboxTable0731F305",
            },
          },
        },
        "FunctionName": "online-banking-withdraw-worker",
        "Handler": "index.handler",
        "Role": {
          "Fn::GetAtt": [
            "WithdrawWorkerLambdaRoleCD38C408",
            "Arn",
          ],
        },
        "Runtime": "nodejs22.x",
        "Timeout": 60,
      },
      "Type": "AWS::Lambda::Function",
    },
    "WithdrawWorkerLambdaRoleCD38C408": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Resource::arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-withdraw-worker:*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "TGFtYmRh6Zai5pWw44Gv5a6f6KGM5pmC44Gr5YuV55qE44Gr44Ot44Kw44K544OI44Oq44O844Og44KS5L2c5oiQ44GZ44KL44Gf44KB44CB44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44GM5b+F6KaB44Gn44GZ44CC44G+44Gf44CBS01T5qip6ZmQ44Gr44Gk44GE44Gm44KC44CBUmVFbmNyeXB0KuOChEdlbmVyYXRlRGF0YUtleSrjga7jg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnjgILjgZPjgozjgonjga9BV1Pjga7mqJnmupbnmoTjgarli5XkvZzjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "Policies": [
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "logs:CreateLogGroup",
                    "logs:CreateLogStream",
                    "logs:PutLogEvents",
                  ],
                  "Effect": "Allow",
                  "Resource": [
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-withdraw-worker",
                    "arn:aws:logs:ap-northeast-1:111111111111:log-group:/aws/lambda/online-banking-withdraw-worker:*",
                  ],
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "CloudWatchLogsPolicy",
          },
          {
            "PolicyDocument": {
              "Statement": [
                {
                  "Action": [
                    "kms:Encrypt",
                    "kms:Decrypt",
                    "kms:ReEncrypt*",
                    "kms:GenerateDataKey*",
                    "kms:DescribeKey",
                  ],
                  "Effect": "Allow",
                  "Resource": {
                    "Fn::GetAtt": [
                      "OnlineBankingKmsKey20BDBC63",
                      "Arn",
                    ],
                  },
                },
              ],
              "Version": "2012-10-17",
            },
            "PolicyName": "KMSPolicy",
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "WithdrawWorkerLambdaRoleDefaultPolicyDE4942E2": {
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "dynamodb:GetItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:Query",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "BalanceTableF6713123",
                    "Arn",
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "OutboxTable0731F305",
                    "Arn",
                  ],
                },
                {
                  "Fn::GetAtt": [
                    "EventStore165FCE28",
                    "Arn",
                  ],
                },
              ],
            },
            {
              "Action": "execute-api:Invoke",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:execute-api:ap-northeast-1:111111111111:",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApi9CC99DBEC3262B35",
                    },
                    "/*",
                  ],
                ],
              },
            },
            {
              "Action": "apigateway:GET",
              "Effect": "Allow",
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    "arn:aws:apigateway:ap-northeast-1::/apikeys/",
                    {
                      "Fn::ImportValue": "CoreBankingSystemStackForBackend:ExportsOutputRefCoreBankingApiCoreBankingApiKey30F6B290C71522C7",
                    },
                  ],
                ],
              },
            },
            {
              "Action": [
                "sqs:ReceiveMessage",
                "sqs:ChangeMessageVisibility",
                "sqs:GetQueueUrl",
                "sqs:DeleteMessage",
                "sqs:GetQueueAttributes",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "WithdrawQueueD317226A",
                  "Arn",
                ],
              },
            },
            {
              "Action": "kms:Decrypt",
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "OnlineBankingKmsKey20BDBC63",
                  "Arn",
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "WithdrawWorkerLambdaRoleDefaultPolicyDE4942E2",
        "Roles": [
          {
            "Ref": "WithdrawWorkerLambdaRoleCD38C408",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "WithdrawWorkerLambdaSqsEventSourceOnlineBankingAppBackendStackWithdrawQueueFF87F48731D9C30B": {
      "Properties": {
        "EventSourceArn": {
          "Fn::GetAtt": [
            "WithdrawQueueD317226A",
            "Arn",
          ],
        },
        "FunctionName": {
          "Ref": "WithdrawWorkerLambda38C73BB9",
        },
      },
      "Type": "AWS::Lambda::EventSourceMapping",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;

exports[`Online Banking App Frontend Stack should create frontend stack 1`] = `
{
  "Description": "Online banking application frontend infrastructure",
  "Outputs": {
    "CloudFrontDistributionId": {
      "Description": "CloudFront Distribution ID",
      "Value": {
        "Ref": "WebsiteDistribution75DCDA0B",
      },
    },
    "CloudFrontDomainName": {
      "Description": "CloudFront Distribution Domain Name",
      "Value": {
        "Fn::GetAtt": [
          "WebsiteDistribution75DCDA0B",
          "DomainName",
        ],
      },
    },
    "WebsiteBucketArn": {
      "Description": "Website S3 Bucket ARN",
      "Value": {
        "Fn::GetAtt": [
          "WebsiteBucket75C24D94",
          "Arn",
        ],
      },
    },
    "WebsiteBucketName": {
      "Description": "Website S3 Bucket Name",
      "Value": {
        "Ref": "WebsiteBucket75C24D94",
      },
    },
    "WebsiteUrl": {
      "Description": "Website URL",
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Fn::GetAtt": [
                "WebsiteDistribution75DCDA0B",
                "DomainName",
              ],
            },
          ],
        ],
      },
    },
  },
  "Parameters": {
    "BootstrapVersion": {
      "Default": "/cdk-bootstrap/hnb659fds/version",
      "Description": "Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuebankingappapiendpointC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/banking-app/api-endpoint",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuebankingappapikeysadminC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/banking-app/api-keys/admin",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuebankingappapikeysauthC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/banking-app/api-keys/auth",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
    "SsmParameterValuebankingappapikeyscustomerC96584B6F00A464EAD1953AFF4B05118Parameter": {
      "Default": "/banking-app/api-keys/customer",
      "Type": "AWS::SSM::Parameter::Value<String>",
    },
  },
  "Resources": {
    "AccessLogsBucket83982689": {
      "DeletionPolicy": "Retain",
      "Properties": {
        "AccessControl": "LogDeliveryWrite",
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "KMSMasterKeyID": {
                  "Fn::GetAtt": [
                    "FrontendKmsKey8FA7D299",
                    "Arn",
                  ],
                },
                "SSEAlgorithm": "aws:kms",
              },
            },
          ],
        },
        "BucketName": "online-banking-app-frontend-logs-111111111111-ap-northeast-1",
        "LifecycleConfiguration": {
          "Rules": [
            {
              "ExpirationInDays": 90,
              "Id": "DeleteOldLogs",
              "Status": "Enabled",
            },
          ],
        },
        "OwnershipControls": {
          "Rules": [
            {
              "ObjectOwnership": "BucketOwnerPreferred",
            },
          ],
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "AccessLogsBucketPolicy7F77476F": {
      "Properties": {
        "Bucket": {
          "Ref": "AccessLogsBucket83982689",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "AccessLogsBucket83982689",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "AccessLogsBucket83982689",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536": {
      "DependsOn": [
        "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF",
        "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
      ],
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-L1",
              "is_reason_encoded": true,
              "reason": "Q0RLIEJ1Y2tldCBEZXBsb3ltZW5044GuTGFtYmRh6Zai5pWw44GvQ0RL44Gr44KI44Gj44Gm6Ieq5YuV566h55CG44GV44KM44Gm44GK44KK44CBcnVudGltZSB2ZXJzaW9u44GvQ0RL44Gu44OQ44O844K444On44Oz44Ki44OD44OX5pmC44Gr5pu05paw44GV44KM44G+44GZ44CC",
            },
          ],
        },
      },
      "Properties": {
        "Code": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "4fe0aba5e672b596d0f72505a9eec502f98d46906bb30fae2511fbdc1df4956f.zip",
        },
        "Environment": {
          "Variables": {
            "AWS_CA_BUNDLE": "/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem",
          },
        },
        "Handler": "index.handler",
        "Layers": [
          {
            "Ref": "DeployWebsiteAwsCliLayer17DBC421",
          },
        ],
        "Role": {
          "Fn::GetAtt": [
            "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
            "Arn",
          ],
        },
        "Runtime": "python3.11",
        "Timeout": 900,
      },
      "Type": "AWS::Lambda::Function",
    },
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Policy::arn:<AWS::Partition>:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
              "id": "AwsSolutions-IAM4",
              "is_reason_encoded": true,
              "reason": "Q0RLIEJ1Y2tldERlcGxveW1lbnTjgYzoh6rli5XnlJ/miJDjgZnjgotMYW1iZGHplqLmlbDjga/jgIFBV1PnrqHnkIbjg53jg6rjgrfjg7zvvIhBV1NMYW1iZGFCYXNpY0V4ZWN1dGlvblJvbGXvvInjgpLkvb/nlKjjgZfjgaZDbG91ZFdhdGNoIExvZ3Pjgbjjga7jgqLjgq/jgrvjgrnjgpLooYzjgYTjgb7jgZnjgILjgZPjgozjga9BV1MgQ0RL44Gu5YaF6YOo5a6f6KOF44Gr44KI44KL5qiZ5rqW55qE44Gq5YuV5L2c44Gn44GC44KK44CB44K744Kt44Ol44Oq44OG44Kj5LiK5ZWP6aGM44GC44KK44G+44Gb44KT44CC",
            },
          ],
        },
      },
      "Properties": {
        "AssumeRolePolicyDocument": {
          "Statement": [
            {
              "Action": "sts:AssumeRole",
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
            },
          ],
          "Version": "2012-10-17",
        },
        "ManagedPolicyArns": [
          {
            "Fn::Join": [
              "",
              [
                "arn:",
                {
                  "Ref": "AWS::Partition",
                },
                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
              ],
            ],
          },
        ],
      },
      "Type": "AWS::IAM::Role",
    },
    "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "applies_to": [
                "Action::s3:GetObject*",
                "Action::s3:GetBucket*",
                "Action::s3:List*",
                "Resource::arn:<AWS::Partition>:s3:::cdk-hnb659fds-assets-111111111111-ap-northeast-1/*",
                "Action::s3:DeleteObject*",
                "Action::s3:Abort*",
                "Resource::<WebsiteBucket75C24D94.Arn>/*",
                "Resource::*",
                "Action::kms:ReEncrypt*",
                "Action::kms:GenerateDataKey*",
              ],
              "id": "AwsSolutions-IAM5",
              "is_reason_encoded": true,
              "reason": "Q0RLIEJ1Y2tldERlcGxveW1lbnTjga/ku6XkuIvjga7nkIbnlLHjgafjg6/jgqTjg6vjg4njgqvjg7zjg4nmqKnpmZDjgYzlv4XopoHjgafjgZnvvJoxKSBDREvjgqLjgrvjg4Pjg4jjg5DjgrHjg4Pjg4jvvIhjZGstKi1hc3NldHMtKu+8ieOBi+OCieOBruOCveODvOOCueODleOCoeOCpOODq+WPluW+l+OAgTIpIFMz5pON5L2c44Gu5YaF6YOo5a6f6KOF44Gn44Ov44Kk44Or44OJ44Kr44O844OJ44Ki44Kv44K344On44Oz77yIR2V0T2JqZWN0KiwgR2V0QnVja2V0KiwgTGlzdCosIERlbGV0ZU9iamVjdCosIEFib3J0Ku+8ieOBjOW/heimgeOAgTMpIENsb3VkRm9ybWF0aW9u44Kr44K544K/44Og44Oq44K944O844K544Gu5YuV55qE44Gq5qip6ZmQ6KaB5rGC44CBNCkgS01T44Kr44K544K/44Oe44O8566h55CG44Kt44O844Gn44Gu5pqX5Y+35YyW5Yem55CG77yIUmVFbmNyeXB0KiwgR2VuZXJhdGVEYXRhS2V5Ku+8ieOAguOBk+OCjOOCieOBr0FXUyBDREvjga7lhoXpg6jjgqLjg7zjgq3jg4bjgq/jg4Hjg6PjgavjgojjgovliLbntITjgafjgYLjgorjgIHjgrvjgq3jg6Xjg6rjg4bjgqPkuIrjgoTjgoDjgpLlvpfjgarjgYToqK3oqIjjgafjgZnjgII=",
            },
          ],
        },
      },
      "Properties": {
        "PolicyDocument": {
          "Statement": [
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::cdk-hnb659fds-assets-111111111111-ap-northeast-1",
                    ],
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":s3:::cdk-hnb659fds-assets-111111111111-ap-northeast-1/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "s3:GetObject*",
                "s3:GetBucket*",
                "s3:List*",
                "s3:DeleteObject*",
                "s3:PutObject",
                "s3:PutObjectLegalHold",
                "s3:PutObjectRetention",
                "s3:PutObjectTagging",
                "s3:PutObjectVersionTagging",
                "s3:Abort*",
              ],
              "Effect": "Allow",
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "WebsiteBucket75C24D94",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "WebsiteBucket75C24D94",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:DescribeKey",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Resource": {
                "Fn::GetAtt": [
                  "FrontendKmsKey8FA7D299",
                  "Arn",
                ],
              },
            },
            {
              "Action": [
                "cloudfront:GetInvalidation",
                "cloudfront:CreateInvalidation",
              ],
              "Effect": "Allow",
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PolicyName": "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRoleDefaultPolicy88902FDF",
        "Roles": [
          {
            "Ref": "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756CServiceRole89A01265",
          },
        ],
      },
      "Type": "AWS::IAM::Policy",
    },
    "DeployWebsiteAwsCliLayer17DBC421": {
      "Properties": {
        "Content": {
          "S3Bucket": "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "S3Key": "12157b27d30ab71eb24ae65825f672ba5cc2c09dbb1703cd7adfcff3aeaca136.zip",
        },
        "Description": "/opt/awscli/aws",
      },
      "Type": "AWS::Lambda::LayerVersion",
    },
    "DeployWebsiteCustomResourceD116527B": {
      "DeletionPolicy": "Delete",
      "Properties": {
        "DestinationBucketName": {
          "Ref": "WebsiteBucket75C24D94",
        },
        "DistributionId": {
          "Ref": "WebsiteDistribution75DCDA0B",
        },
        "DistributionPaths": [
          "/*",
        ],
        "OutputObjectKeys": true,
        "Prune": true,
        "ServiceToken": {
          "Fn::GetAtt": [
            "CustomCDKBucketDeployment8693BB64968944B69AAFB0CC9EB8756C81C01536",
            "Arn",
          ],
        },
        "SourceBucketNames": [
          "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
          "cdk-hnb659fds-assets-111111111111-ap-northeast-1",
        ],
        "SourceMarkers": [
          {},
          {
            "<<marker:0xbaba:0>>": {
              "Ref": "SsmParameterValuebankingappapiendpointC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "<<marker:0xbaba:1>>": {
              "Ref": "SsmParameterValuebankingappapikeyscustomerC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "<<marker:0xbaba:2>>": {
              "Ref": "SsmParameterValuebankingappapikeysadminC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
            "<<marker:0xbaba:3>>": {
              "Ref": "SsmParameterValuebankingappapikeysauthC96584B6F00A464EAD1953AFF4B05118Parameter",
            },
          },
        ],
        "SourceObjectKeys": Any<Array>,
      },
      "Type": "Custom::CDKBucketDeployment",
      "UpdateReplacePolicy": "Delete",
    },
    "FrontendKmsKey8FA7D299": {
      "DeletionPolicy": "Delete",
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-KMS5",
              "is_reason_encoded": true,
              "reason": "S01T44Kt44O844Od44Oq44K344O844Gn44Gv44CB44Kt44O8566h55CG44Go44OH44O844K/44Ki44Kv44K744K544Gu6IG35o6M5YiG6Zui44KS5a6f54++44GZ44KL44Gf44KB44CB6YGp5YiH44Gq44OX44Oq44Oz44K344OR44Or44Gr5a++44GX44Gm44Ov44Kk44Or44OJ44Kr44O844OJ5qip6ZmQ44KS5LuY5LiO44GX44Gm44GE44G+44GZ44CC44GT44KM44GvRklTQ+WuieWFqOWvvuetluWfuua6luOBruaal+WPt+WMlumNteeuoeeQhuimgeS7tuOBq+a6luaLoOOBl+OBn+ioreioiOOBp+OBmeOAgg==",
            },
          ],
        },
      },
      "Properties": {
        "Description": "Frontend S3 buckets encryption key for FISC compliance",
        "EnableKeyRotation": true,
        "KeyPolicy": {
          "Statement": [
            {
              "Action": "kms:*",
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::111111111111:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
              "Sid": "EnableRootAccountAccess",
            },
            {
              "Action": [
                "kms:Create*",
                "kms:Describe*",
                "kms:Enable*",
                "kms:List*",
                "kms:Put*",
                "kms:Update*",
                "kms:Revoke*",
                "kms:Disable*",
                "kms:Get*",
                "kms:Delete*",
                "kms:TagResource",
                "kms:UntagResource",
                "kms:ScheduleKeyDeletion",
                "kms:CancelKeyDeletion",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": "cloudformation.amazonaws.com",
              },
              "Resource": "*",
              "Sid": "AllowKeyAdministration",
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
                "kms:DescribeKey",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "dynamodb.amazonaws.com",
                  "s3.amazonaws.com",
                  "lambda.amazonaws.com",
                  "sqs.amazonaws.com",
                  "logs.amazonaws.com",
                ],
              },
              "Resource": "*",
              "Sid": "AllowKeyUsage",
            },
            {
              "Action": [
                "kms:CreateGrant",
                "kms:ListGrants",
                "kms:RevokeGrant",
              ],
              "Condition": {
                "Bool": {
                  "kms:GrantIsForAWSResource": "true",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": [
                  "dynamodb.amazonaws.com",
                  "s3.amazonaws.com",
                  "lambda.amazonaws.com",
                  "sqs.amazonaws.com",
                  "logs.amazonaws.com",
                ],
              },
              "Resource": "*",
              "Sid": "AllowAttachmentOfPersistentResources",
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
                "kms:DescribeKey",
              ],
              "Condition": {
                "StringEquals": {
                  "kms:ViaService": [
                    "dynamodb.ap-northeast-1.amazonaws.com",
                  ],
                },
              },
              "Effect": "Allow",
              "Principal": {
                "AWS": {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition",
                      },
                      ":iam::111111111111:root",
                    ],
                  ],
                },
              },
              "Resource": "*",
              "Sid": "AllowCustomResourceAccess",
            },
            {
              "Action": [
                "kms:Encrypt",
                "kms:Decrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
                "kms:DescribeKey",
              ],
              "Condition": {
                "StringEquals": {
                  "aws:SourceAccount": "111111111111",
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "lambda.amazonaws.com",
              },
              "Resource": "*",
              "Sid": "AllowLambdaDirectAccess",
            },
            {
              "Action": [
                "kms:Decrypt",
                "kms:Encrypt",
                "kms:ReEncrypt*",
                "kms:GenerateDataKey*",
              ],
              "Effect": "Allow",
              "Principal": {
                "Service": "logging.s3.amazonaws.com",
              },
              "Resource": "*",
            },
            {
              "Action": "kms:Decrypt",
              "Condition": {
                "ArnLike": {
                  "AWS:SourceArn": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition",
                        },
                        ":cloudfront::",
                        {
                          "Ref": "AWS::AccountId",
                        },
                        ":distribution/*",
                      ],
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "cloudfront.amazonaws.com",
              },
              "Resource": "*",
            },
          ],
          "Version": "2012-10-17",
        },
        "PendingWindowInDays": 30,
        "Tags": [
          {
            "Key": "Environment",
            "Value": "OnlineBankingAppFrontendStack",
          },
          {
            "Key": "KeyRotation",
            "Value": "Enabled",
          },
          {
            "Key": "Purpose",
            "Value": "FISC-Compliance",
          },
        ],
      },
      "Type": "AWS::KMS::Key",
      "UpdateReplacePolicy": "Delete",
    },
    "FrontendKmsKeyAlias087A64F9": {
      "Properties": {
        "AliasName": "alias/online-banking-frontend",
        "TargetKeyId": {
          "Fn::GetAtt": [
            "FrontendKmsKey8FA7D299",
            "Arn",
          ],
        },
      },
      "Type": "AWS::KMS::Alias",
    },
    "WebsiteBucket75C24D94": {
      "DeletionPolicy": "Retain",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "KMSMasterKeyID": {
                  "Fn::GetAtt": [
                    "FrontendKmsKey8FA7D299",
                    "Arn",
                  ],
                },
                "SSEAlgorithm": "aws:kms",
              },
            },
          ],
        },
        "BucketName": "online-banking-app-frontend-111111111111-ap-northeast-1",
        "LoggingConfiguration": {
          "DestinationBucketName": {
            "Ref": "AccessLogsBucket83982689",
          },
          "LogFilePrefix": "website-access-logs/",
        },
        "PublicAccessBlockConfiguration": {
          "BlockPublicAcls": true,
          "BlockPublicPolicy": true,
          "IgnorePublicAcls": true,
          "RestrictPublicBuckets": true,
        },
        "Tags": [
          {
            "Key": "aws-cdk:cr-owned:f8ddfa18",
            "Value": "true",
          },
        ],
        "VersioningConfiguration": {
          "Status": "Enabled",
        },
      },
      "Type": "AWS::S3::Bucket",
      "UpdateReplacePolicy": "Retain",
    },
    "WebsiteBucketPolicyE10E3262": {
      "Properties": {
        "Bucket": {
          "Ref": "WebsiteBucket75C24D94",
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": "false",
                },
              },
              "Effect": "Deny",
              "Principal": {
                "AWS": "*",
              },
              "Resource": [
                {
                  "Fn::GetAtt": [
                    "WebsiteBucket75C24D94",
                    "Arn",
                  ],
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      {
                        "Fn::GetAtt": [
                          "WebsiteBucket75C24D94",
                          "Arn",
                        ],
                      },
                      "/*",
                    ],
                  ],
                },
              ],
            },
            {
              "Action": "s3:GetObject",
              "Condition": {
                "StringEquals": {
                  "AWS:SourceArn": {
                    "Fn::Join": [
                      "",
                      [
                        "arn:",
                        {
                          "Ref": "AWS::Partition",
                        },
                        ":cloudfront::",
                        {
                          "Ref": "AWS::AccountId",
                        },
                        ":distribution/",
                        {
                          "Ref": "WebsiteDistribution75DCDA0B",
                        },
                      ],
                    ],
                  },
                },
              },
              "Effect": "Allow",
              "Principal": {
                "Service": "cloudfront.amazonaws.com",
              },
              "Resource": {
                "Fn::Join": [
                  "",
                  [
                    {
                      "Fn::GetAtt": [
                        "WebsiteBucket75C24D94",
                        "Arn",
                      ],
                    },
                    "/*",
                  ],
                ],
              },
            },
          ],
          "Version": "2012-10-17",
        },
      },
      "Type": "AWS::S3::BucketPolicy",
    },
    "WebsiteDistribution75DCDA0B": {
      "Metadata": {
        "cdk_nag": {
          "rules_to_suppress": [
            {
              "id": "AwsSolutions-CFR4",
              "is_reason_encoded": true,
              "reason": "44GT44Gu44Oq44OV44Kh44Os44Oz44K544Ki44O844Kt44OG44Kv44OB44Oj44Gn44Gv44Kr44K544K/44Og44OJ44Oh44Kk44Oz44KS5Yip55So44Gb44Ga44CBQ2xvdWRGcm9udOOBruODh+ODleOCqeODq+ODiOODieODoeOCpOODs+OCkuS9v+eUqOOBl+OBvuOBmeOAglRMU+ioreWumuOBr0FXU+OBq+OCiOOBo+OBpueuoeeQhuOBleOCjOOBvuOBmeOAgg==",
            },
            {
              "id": "AwsSolutions-CFR5",
              "is_reason_encoded": true,
              "reason": "44GT44Gu44Oq44OV44Kh44Os44Oz44K544Ki44O844Kt44OG44Kv44OB44Oj44Gn44GvQ2xvdWRGcm9udOOBruODh+ODleOCqeODq+ODiOODieODoeOCpOODs+OCkuS9v+eUqOOBl+OBvuOBmeOAguOCquODquOCuOODs+mWk+mAmuS/oeOBrlRMU+ioreWumuOBr0FXU+OBq+OCiOOBo+OBpueuoeeQhuOBleOCjOOBvuOBmeOAgg==",
            },
          ],
        },
      },
      "Properties": {
        "DistributionConfig": {
          "Comment": "Online Banking App - Frontend (ap-northeast-1)",
          "CustomErrorResponses": [
            {
              "ErrorCachingMinTTL": 300,
              "ErrorCode": 404,
              "ResponseCode": 200,
              "ResponsePagePath": "/index.html",
            },
          ],
          "DefaultCacheBehavior": {
            "CachePolicyId": "658327ea-f89d-4fab-a63d-7e88639e58f6",
            "Compress": true,
            "TargetOriginId": "OnlineBankingAppFrontendStackWebsiteDistributionOrigin15EA21860",
            "ViewerProtocolPolicy": "redirect-to-https",
          },
          "DefaultRootObject": "index.html",
          "Enabled": true,
          "HttpVersion": "http2",
          "IPV6Enabled": true,
          "Logging": {
            "Bucket": {
              "Fn::GetAtt": [
                "AccessLogsBucket83982689",
                "RegionalDomainName",
              ],
            },
            "IncludeCookies": false,
            "Prefix": "cloudfront-access-logs/",
          },
          "Origins": [
            {
              "DomainName": {
                "Fn::GetAtt": [
                  "WebsiteBucket75C24D94",
                  "RegionalDomainName",
                ],
              },
              "Id": "OnlineBankingAppFrontendStackWebsiteDistributionOrigin15EA21860",
              "OriginAccessControlId": {
                "Fn::GetAtt": [
                  "WebsiteDistributionOrigin1S3OriginAccessControlAD90E5FA",
                  "Id",
                ],
              },
              "S3OriginConfig": {
                "OriginAccessIdentity": "",
              },
            },
          ],
          "Restrictions": {
            "GeoRestriction": {
              "Locations": [
                "JP",
              ],
              "RestrictionType": "whitelist",
            },
          },
        },
      },
      "Type": "AWS::CloudFront::Distribution",
    },
    "WebsiteDistributionOrigin1S3OriginAccessControlAD90E5FA": {
      "Properties": {
        "OriginAccessControlConfig": {
          "Name": "OnlineBankingAppFrontendStacOrigin1S3OriginAccessControl95155391",
          "OriginAccessControlOriginType": "s3",
          "SigningBehavior": "always",
          "SigningProtocol": "sigv4",
        },
      },
      "Type": "AWS::CloudFront::OriginAccessControl",
    },
  },
  "Rules": {
    "CheckBootstrapVersion": {
      "Assertions": [
        {
          "Assert": {
            "Fn::Not": [
              {
                "Fn::Contains": [
                  [
                    "1",
                    "2",
                    "3",
                    "4",
                    "5",
                  ],
                  {
                    "Ref": "BootstrapVersion",
                  },
                ],
              },
            ],
          },
          "AssertDescription": "CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.",
        },
      ],
    },
  },
}
`;
